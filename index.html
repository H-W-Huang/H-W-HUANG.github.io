<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HWHuangçš„åšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="HWHuangçš„åšå®¢">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="HWHuangçš„åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HWHuangçš„åšå®¢">
  
    <link rel="alternate" href="/atom.xml" title="HWHuangçš„åšå®¢" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class="active"
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">HWHuangçš„åšå®¢</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          
  
    <article id="post-test-1" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/29/test-1/">test</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/29/test-1/" class="article-date"><time datetime="2017-08-29T11:52:23.000Z" itemprop="datePublished">2017-08-29</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/29/test-1/" data-id="cj6xjfezy000ptsjoo0dg6ife" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-hbase" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/29/hbase/">HBase ç®€ä»‹</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/29/hbase/" class="article-date"><time datetime="2017-08-29T11:43:13.000Z" itemprop="datePublished">2017-08-29</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä»€ä¹ˆæ˜¯HBase"><a href="#ä»€ä¹ˆæ˜¯HBase" class="headerlink" title="ä»€ä¹ˆæ˜¯HBase"></a>ä»€ä¹ˆæ˜¯HBase</h2><p>â€‹    HBaseæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ï¼Œè¯¥æŠ€æœ¯æ¥æºäº Fay Chang æ‰€æ’°å†™çš„Googleè®ºæ–‡â€œBigtableï¼šä¸€ä¸ªç»“æ„åŒ–æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿâ€ã€‚å°±åƒBigtableåˆ©ç”¨äº†Googleæ–‡ä»¶ç³»ç»Ÿï¼ˆFile Systemï¼‰æ‰€æä¾›çš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ä¸€æ ·ï¼ŒHBaseåœ¨Hadoopä¹‹ä¸Šæä¾›äº†ç±»ä¼¼äºBigtableçš„èƒ½åŠ›ã€‚HBaseæ˜¯Apacheçš„Hadoopé¡¹ç›®çš„å­é¡¹ç›®ã€‚HBaseä¸åŒäºä¸€èˆ¬çš„å…³ç³»æ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€‚åˆäºéç»“æ„åŒ–æ•°æ®å­˜å‚¨çš„æ•°æ®åº“ã€‚å¦ä¸€ä¸ªä¸åŒçš„æ˜¯HBase<strong>åŸºäºåˆ—çš„è€Œä¸æ˜¯åŸºäºè¡Œ</strong>çš„æ¨¡å¼ã€‚</p>
<p><img src="/2017/08/29/hbase/b3b7d0a20cf431ad8b01445e4b36acaf2fdd9881.jpg" alt=""></p>
<h2 id="HBaseçš„ç‰¹ç‚¹"><a href="#HBaseçš„ç‰¹ç‚¹" class="headerlink" title="HBaseçš„ç‰¹ç‚¹"></a>HBaseçš„ç‰¹ç‚¹</h2><p>HBaseæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>å¤§ï¼ˆåœ¨ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰æ•°åäº¿è¡Œï¼Œä¸Šç™¾ä¸‡åˆ—ï¼‰</li>
<li>æ— æ¨¡å¼</li>
<li>é¢å‘åˆ—</li>
<li>ç¨€ç–æ–¹å¼å­˜å‚¨</li>
<li>æ•°æ®å¤šç‰ˆæœ¬ï¼ˆæ¯ä¸ªå•å…ƒçš„æ•°æ®å¯ä»¥æœ‰<strong>å¤šä¸ªç‰ˆæœ¬</strong>ï¼‰</li>
<li>æ•°æ®ç±»å‹å•ä¸€ï¼ˆå…¨éƒ¨æ˜¯Stringï¼‰</li>
</ol>
<p><em>å…³äºæŒ‰è¡Œå­˜å‚¨å’ŒæŒ‰åˆ—å­˜å‚¨</em><br>â€‹    æŒ‰è¡Œå­˜å‚¨ï¼Œä»¥ä¼ ç»Ÿçš„ RDBMS ä¸ºä¾‹ï¼Œä¸ºæŸä¸€ä¸ªè¡¨æ’å…¥æŸä¸€æ¡æ•°æ®æ—¶ï¼Œæ’å…¥çš„åŸºæœ¬å•ä½æ˜¯<strong>è¡Œ</strong>ï¼›<br>â€‹    æŒ‰åˆ—å­˜å‚¨ï¼Œä¸ºè¡¨æ ¼æ’å…¥æŸä¸€æ¡æ•°æ®æ—¶ï¼Œæ’å…¥çš„åŸºæœ¬å•ä½æ˜¯<strong>åˆ—</strong>ã€‚<br>HBase æœ¬èº«å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¤§çš„ Map ï¼ŒæŒ‰ç…§Keyå’ŒValueæ¥å­˜æ•°æ®ã€‚</p>
<h2 id="HBaseçš„ç»„æˆ"><a href="#HBaseçš„ç»„æˆ" class="headerlink" title="HBaseçš„ç»„æˆ"></a>HBaseçš„ç»„æˆ</h2><p>HBaseæœ‰ä»¥ä¸‹çš„åŸºæœ¬æ¦‚å¿µï¼š</p>
<p><img src="/2017/08/29/hbase/BaseåŸºæœ¬æ¦‚å¿µ.png" alt=""></p>
<ol>
<li>Row Keyï¼š<br>æœ¬èº«æ˜¯ä¸€ä¸ª <strong>Byte Array</strong> ã€‚ä½œä¸ºè¡¨ä¸­è®°å½•çš„<strong>ä¸»é”®</strong>ã€‚</li>
<li>Column Familyï¼š<br>æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²åç§°ï¼Œå«æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ—ã€‚</li>
<li>Columnï¼š<br>ä»å±äºæŸä¸€ä¸ª Column Family ï¼Œåˆ—åç§°æ˜¯ç¼–ç åœ¨Cellä¸­çš„ï¼›</li>
<li>Version Numberï¼š<br>æ¯ä¸€ä¸ª row Key çš„ Version Number æ˜¯å”¯ä¸€çš„ï¼›<br>é»˜è®¤å€¼ä¸ºï¼š<strong>æ—¶é—´æˆ³</strong>ï¼›<br>ç±»å‹ï¼šLong</li>
<li>Value<br>ä»¥ Byte Array çš„å½¢å¼å­˜å‚¨ã€‚</li>
</ol>
<p>HBaseçš„ç»“æ„<br><img src="/2017/08/29/hbase/HBaseTables.png" alt=""></p>
<h2 id="HBaseæ¶æ„"><a href="#HBaseæ¶æ„" class="headerlink" title="HBaseæ¶æ„"></a>HBaseæ¶æ„</h2><p>â€‹    åœ¨ HBase çš„é›†ç¾¤ä¸­ä¸»è¦ç”± Master å’Œ Region Server ç»„æˆï¼Œä»¥åŠ Zookeeperï¼Œå…·ä½“æ¨¡å—å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2017/08/29/hbase/image002.png" alt=""></p>
<p>â€‹    å¯è§ï¼ŒHBaseæ˜¯å»ºç«‹åœ¨HDFSä¸Šçš„ã€‚</p>
<h3 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h3><p>HBase Master ç”¨äº</p>
<ol>
<li><strong>åè°ƒ</strong>å¤šä¸ª Region Serverï¼›</li>
<li><strong>ä¾¦æµ‹</strong>å„ä¸ª Region Server ä¹‹é—´çš„çŠ¶æ€ï¼›</li>
<li><strong>å¹³è¡¡</strong> Region Server ä¹‹é—´çš„è´Ÿè½½ï¼›</li>
<li><strong>åˆ†é…</strong> Region ç»™ Region Serverï¼›</li>
<li><strong>DDL</strong>æ“ä½œï¼›<br><u>HBase å…è®¸å¤šä¸ª Master èŠ‚ç‚¹å…±å­˜</u> ï¼Œä½†æ˜¯è¿™éœ€è¦ Zookeeper çš„å¸®åŠ©ã€‚ä¸è¿‡å½“å¤šä¸ª Master èŠ‚ç‚¹å…±å­˜æ—¶ï¼Œåªæœ‰ä¸€ä¸ª Master æ˜¯æä¾›æœåŠ¡çš„ï¼Œå…¶ä»–çš„ Master èŠ‚ç‚¹å¤„äºå¾…å‘½çš„çŠ¶æ€ã€‚å½“æ­£åœ¨å·¥ä½œçš„ Master èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå…¶ä»–çš„ Master åˆ™ä¼šæ¥ç®¡ HBase çš„é›†ç¾¤ã€‚</li>
</ol>
<h3 id="Region-Server"><a href="#Region-Server" class="headerlink" title="Region Server"></a>Region Server</h3><p>â€‹    å¯¹äºä¸€ä¸ª Region Server è€Œè¨€ï¼Œå…¶ ~åŒ…æ‹¬äº†å¤šä¸ª Region~ ã€‚Region Server çš„ä½œç”¨åªæ˜¯<strong>ç®¡ç†è¡¨æ ¼</strong>ï¼Œä»¥åŠå®ç°<strong>è¯»å†™æ“ä½œ</strong>ã€‚Client ç›´æ¥è¿æ¥ Region Serverï¼Œå¹¶é€šä¿¡è·å– HBase ä¸­çš„æ•°æ®ã€‚</p>
<h3 id="Region"><a href="#Region" class="headerlink" title="Region"></a>Region</h3><p>â€‹    [image:F70C090E-38E1-4A96-B349-2BCD779FDD49-4784-000046EBEFB38D5B/Region.png]</p>
<p>â€‹    å¯¹äº Region è€Œè¨€ï¼Œåˆ™æ˜¯çœŸå®å­˜æ”¾ HBase æ•°æ®çš„åœ°æ–¹ï¼Œä¹Ÿå°±è¯´ ~Region æ˜¯ HBase å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼çš„åŸºæœ¬å•ä½~ ã€‚å¦‚æœå½“ä¸€ä¸ªè¡¨æ ¼å¾ˆå¤§ï¼Œå¹¶ç”±å¤šä¸ª CF ç»„æˆæ—¶ï¼Œé‚£ä¹ˆè¡¨çš„æ•°æ®å°†å­˜æ”¾åœ¨å¤šä¸ª Region ä¹‹é—´ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ª Region ä¸­ä¼šå…³è”å¤šä¸ªå­˜å‚¨çš„å•å…ƒï¼ˆStoreï¼‰ã€‚    </p>
<p>â€‹    æ¯ä¸ª Region åŒ…å«ç€å¤šä¸ª Store å¯¹è±¡ã€‚æ¯ä¸ª Store åŒ…å«ä¸€ä¸ª MemStoreï¼Œå’Œä¸€ä¸ªæˆ–å¤šä¸ª HFileã€‚</p>
<h4 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h4><p>â€‹    </p>
<p>â€‹    Zookeeper æ˜¯ä½œä¸º HBase Master çš„ HA è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯ Zookeeper ä¿è¯äº†è‡³å°‘æœ‰ä¸€ä¸ª HBase Master å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å¹¶ä¸” Zookeeper è´Ÿè´£ Region å’Œ Region Server çš„æ³¨å†Œã€‚å…¶å® Zookeeper å‘å±•åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»æˆä¸ºäº†åˆ†å¸ƒå¼å¤§æ•°æ®æ¡†æ¶ä¸­å®¹é”™æ€§çš„æ ‡å‡†æ¡†æ¶ã€‚ä¸å…‰æ˜¯ HBaseï¼Œå‡ ä¹æ‰€æœ‰çš„åˆ†å¸ƒå¼å¤§æ•°æ®ç›¸å…³çš„å¼€æºæ¡†æ¶ï¼Œéƒ½ä¾èµ–äº Zookeeper å®ç° HAï¼ˆHigh Availableï¼‰ã€‚    </p>
<p>â€‹    HBase Master ä¸ Region Server ä¹‹é—´çš„å…³ç³»æ˜¯ä¾èµ– Zookeeper æ¥ç»´æŠ¤çš„ã€‚</p>
<p><a href="https://www.ibm.com/developerworks/cn/analytics/library/ba-cn-bigdata-hbase/index.html" target="_blank" rel="external">HBase æ·±å…¥æµ…å‡º</a></p>
<h2 id="HBaseçš„å·¥ä½œæµç¨‹"><a href="#HBaseçš„å·¥ä½œæµç¨‹" class="headerlink" title="HBaseçš„å·¥ä½œæµç¨‹"></a>HBaseçš„å·¥ä½œæµç¨‹</h2><p><img src="/2017/08/29/hbase/image003.png" alt=""></p>
<p>ğŸ‘‰ Client -&gt;   Region Server:</p>
<p>â€‹    å½“ä¸€ä¸ª Client éœ€è¦è®¿é—® HBase é›†ç¾¤æ—¶ï¼ŒClient éœ€è¦å…ˆå’Œ Zookeeper æ¥é€šä¿¡ï¼Œç„¶åæ‰ä¼šæ‰¾åˆ°å¯¹åº”çš„ Region Serverã€‚</p>
<p>ğŸ‘‰  Region Server -&gt; Region:</p>
<p>â€‹    æ¯ä¸€ä¸ª Region Server ç®¡ç†ç€å¾ˆå¤šä¸ª Regionã€‚ ~å¯¹äº HBase æ¥è¯´ï¼ŒRegion æ˜¯ HBase å¹¶è¡ŒåŒ–çš„åŸºæœ¬å•å…ƒã€‚~ å› æ­¤ï¼Œæ•°æ®ä¹Ÿéƒ½å­˜å‚¨åœ¨ Region ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œ ~æ¯ä¸€ä¸ª Region éƒ½<strong>åªå­˜å‚¨ä¸€ä¸ª</strong> Column Family çš„æ•°æ®ï¼Œå¹¶ä¸”æ˜¯è¯¥ CF ä¸­çš„ä¸€æ®µï¼ˆæŒ‰ Row çš„åŒºé—´åˆ†æˆå¤šä¸ª Regionï¼‰~ ã€‚Region æ‰€èƒ½å­˜å‚¨çš„æ•°æ®å¤§å°æ˜¯æœ‰<strong>ä¸Šé™</strong>çš„ï¼Œå½“è¾¾åˆ°è¯¥ä¸Šé™æ—¶ï¼ˆThresholdï¼‰ï¼ŒRegion ä¼šè¿›è¡Œ<strong>åˆ†è£‚</strong>ï¼Œæ•°æ®ä¹Ÿä¼šåˆ†è£‚åˆ°å¤šä¸ª Region ä¸­ï¼Œè¿™æ ·ä¾¿å¯ä»¥æé«˜æ•°æ®çš„å¹¶è¡ŒåŒ–ï¼Œä»¥åŠæé«˜æ•°æ®çš„å®¹é‡ã€‚æ¯ä¸ª Region åŒ…å«ç€å¤šä¸ª Store å¯¹è±¡ã€‚æ¯ä¸ª Store åŒ…å«ä¸€ä¸ª MemStoreï¼Œå’Œä¸€ä¸ªæˆ–å¤šä¸ª HFileã€‚MemStore ä¾¿æ˜¯æ•°æ®åœ¨<strong>å†…å­˜ä¸­çš„å®ä½“</strong>ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½æ˜¯<strong>æœ‰åºçš„</strong>ã€‚</p>
<p>ğŸ‘‰  Region -&gt; HDFS:</p>
<p>â€‹    å½“æ•°æ®å‘ Region å†™å…¥çš„æ—¶å€™ï¼Œä¼šå…ˆå†™å…¥ MemStoreã€‚<br>â€‹    å½“ MemStore ä¸­çš„æ•°æ®éœ€è¦å‘åº•å±‚æ–‡ä»¶ç³»ç»Ÿå€¾å€’ï¼ˆDumpï¼‰æ—¶ï¼ˆä¾‹å¦‚ MemStore ä¸­çš„æ•°æ®ä½“ç§¯åˆ°è¾¾ MemStore é…ç½®çš„æœ€å¤§å€¼ï¼‰ï¼ŒStore ä¾¿ä¼šåˆ›å»º         StoreFileï¼Œè€Œ StoreFile å°±æ˜¯å¯¹ HFile ä¸€å±‚å°è£…ã€‚<br>â€‹    æ‰€ä»¥ MemStore ä¸­çš„æ•°æ®ä¼šæœ€ç»ˆå†™å…¥åˆ° HFile ä¸­ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜ IOã€‚<br>â€‹    ç”±äº HBase åº•å±‚ä¾é  HDFSï¼Œå› æ­¤ HFile éƒ½å­˜å‚¨åœ¨ HDFS ä¹‹ä¸­ã€‚</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/29/hbase/" data-id="cj6xjfezl000ftsjo4flfcm27" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/">HBase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NoSQL/">NoSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/æ•°æ®å­˜å‚¨/">æ•°æ®å­˜å‚¨</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-hiveIntro" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/18/hiveIntro/">hiveç®€ä»‹</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/18/hiveIntro/" class="article-date"><time datetime="2017-08-18T01:12:45.000Z" itemprop="datePublished">2017-08-18</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hiveæ˜¯ä»€ä¹ˆ"><a href="#Hiveæ˜¯ä»€ä¹ˆ" class="headerlink" title="Hiveæ˜¯ä»€ä¹ˆ"></a>Hiveæ˜¯ä»€ä¹ˆ</h2><pre><code>hiveæ˜¯**åŸºäºHadoop**çš„ä¸€ä¸ª**æ•°æ®ä»“åº“å·¥å…·**ï¼Œå¯ä»¥å°†**ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶**æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç®€å•çš„**sqlæŸ¥è¯¢**åŠŸèƒ½ï¼Œå¯ä»¥ ~å°†sqlè¯­å¥è½¬æ¢ä¸ºMapReduceä»»åŠ¡è¿›è¡Œè¿è¡Œ~ ã€‚ å…¶ä¼˜ç‚¹æ˜¯å­¦ä¹ æˆæœ¬ä½ï¼Œå¯ä»¥é€šè¿‡ç±»SQLè¯­å¥å¿«é€Ÿå®ç°ç®€å•çš„MapReduceç»Ÿè®¡ï¼Œä¸å¿…å¼€å‘ä¸“é—¨çš„MapReduceåº”ç”¨ï¼Œååˆ†é€‚åˆæ•°æ®ä»“åº“çš„ç»Ÿè®¡åˆ†æã€‚
</code></pre><h3 id="Hadoopå’ŒHiveçš„å…³ç³»"><a href="#Hadoopå’ŒHiveçš„å…³ç³»" class="headerlink" title="Hadoopå’ŒHiveçš„å…³ç³»"></a>Hadoopå’ŒHiveçš„å…³ç³»</h3><pre><code>ä¸‹å›¾å±•ç¤ºHadoopå’ŒHiveä¹‹é—´çš„å…³ç³»ã€‚
</code></pre><p><img src="/2017/08/18/hiveIntro/HiveAndHadoop.tiff" alt=""></p>
<h3 id="Hiveåœ¨HadoopæŠ€æœ¯æ ˆä¸­æ‰€å¤„çš„ä½ç½®"><a href="#Hiveåœ¨HadoopæŠ€æœ¯æ ˆä¸­æ‰€å¤„çš„ä½ç½®" class="headerlink" title="Hiveåœ¨HadoopæŠ€æœ¯æ ˆä¸­æ‰€å¤„çš„ä½ç½®"></a>Hiveåœ¨HadoopæŠ€æœ¯æ ˆä¸­æ‰€å¤„çš„ä½ç½®</h3><p><img src="/2017/08/18/hiveIntro/HiveInStack.tiff" alt=""></p>
<h2 id="Hiveçš„æ¶æ„"><a href="#Hiveçš„æ¶æ„" class="headerlink" title="Hiveçš„æ¶æ„"></a>Hiveçš„æ¶æ„</h2><pre><code>Hiveçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
</code></pre><p><img src="/2017/08/18/hiveIntro/HiveArch.tiff" alt=""></p>
<p><img src="/2017/08/18/hiveIntro/HiveArch2.tiff" alt=""></p>
<p>Hiveä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>ç”¨æˆ·æ¥å£ï¼ŒåŒ…æ‹¬ CLIï¼ŒJDBC/ODBCï¼ŒWebUI<br>â€¢ å…ƒæ•°æ®å­˜å‚¨(metastore)ï¼Œ hive çš„å…ƒæ•°æ®ç»“æ„æè¿°ä¿¡æ¯åº“ï¼Œå¯é€‰ç”¨ä¸åŒçš„å…³ç³»å‹æ•°æ®åº“æ¥å­˜å‚¨ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ã€æŸ¥çœ‹æ•°æ®åº“é…ç½®ä¿¡æ¯ã€‚é»˜è®¤å­˜å‚¨åœ¨è‡ªå¸¦çš„æ•°æ®åº“derbyä¸­ï¼Œçº¿ä¸Šä½¿ç”¨æ—¶ä¸€èˆ¬<br>æ¢ä¸ºMySQLï¼›<br>â€¢ é©±åŠ¨å™¨(Driver)ï¼Œè§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ï¼›è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å®ŒæˆHQLæŸ¥è¯¢è¯­å¥ä»<strong>è¯æ³•åˆ†æ</strong>ã€<strong>è¯­æ³•åˆ†æ</strong>ã€<strong>ç¼–è¯‘</strong>ã€<strong>ä¼˜åŒ–</strong>ä»¥åŠ<strong>æŸ¥è¯¢è®¡åˆ’çš„ç”Ÿæˆ</strong>ã€‚ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’å­˜å‚¨åœ¨HDFSä¸­ï¼Œå¹¶åœ¨éšå<strong>ç”±MapReduceè°ƒç”¨</strong>æ‰§è¡Œã€‚<br>â€¢ Hadoopï¼Œç”¨MapReduce è¿›è¡Œè®¡ç®—ï¼Œç”¨ HDFS è¿›è¡Œå­˜å‚¨ï¼›</li>
</ul>
<h2 id="Hiveçš„æ•°æ®å­˜å‚¨"><a href="#Hiveçš„æ•°æ®å­˜å‚¨" class="headerlink" title="Hiveçš„æ•°æ®å­˜å‚¨"></a>Hiveçš„æ•°æ®å­˜å‚¨</h2><pre><code>Hiveæ²¡æœ‰ä¸“é—¨çš„æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œä¹Ÿæ²¡æœ‰ä¸ºæ•°æ®å»ºç«‹ç´¢å¼•ï¼Œç”¨æˆ·å¯ä»¥éå¸¸è‡ªç”±çš„ç»„ç»‡ Hive ä¸­çš„è¡¨ã€‚ï¼ˆä¹Ÿä¹Ÿä¸ºä¸èƒ½å»ºç«‹ç´¢å¼•ï¼Œæ‰éœ€è¦ä½¿ç”¨Bucketï¼‰
Hive ä¸­**æ‰€æœ‰**çš„æ•°æ®éƒ½**å­˜å‚¨åœ¨ HDFS** ä¸­ï¼ŒHiveä¸­åŒ…å«ä»¥ä¸‹**å››ç§æ•°æ®æ¨¡å‹**:Tableï¼ŒExternal Tableï¼ŒPartitionï¼ŒBucketã€‚
Hive ä¸­çš„ Table å’Œæ•°æ®åº“ä¸­çš„ Table åœ¨æ¦‚å¿µä¸Š æ˜¯ç±»ä¼¼çš„ï¼Œ**æ¯ä¸€ä¸ª Table åœ¨ Hive ä¸­éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„ç›®å½•å­˜å‚¨æ•°æ®**ã€‚
</code></pre><h3 id="å››ç§æ•°æ®æ¨¡å‹"><a href="#å››ç§æ•°æ®æ¨¡å‹" class="headerlink" title="å››ç§æ•°æ®æ¨¡å‹"></a>å››ç§æ•°æ®æ¨¡å‹</h3><h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><h4 id="partition"><a href="#partition" class="headerlink" title="partition"></a>partition</h4><pre><code>Hive è¡¨ä¸­çš„ä¸€ä¸ª Partition å¯¹åº”äºè¡¨ä¸‹çš„ä¸€ä¸ªç›®å½•,æ‰€æœ‰çš„Partition çš„æ•°æ®**éƒ½å­˜å‚¨åœ¨å¯¹åº”çš„ç›®å½•ä¸­**ã€‚
</code></pre><h4 id="Buckets"><a href="#Buckets" class="headerlink" title="Buckets"></a>Buckets</h4><pre><code>Buckets å¯¹æŒ‡å®šåˆ—è®¡ç®— hash,æ ¹æ® hash å€¼**åˆ‡åˆ†æ•°æ®**,æ¯ä¸€ä¸ª Bucket å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ã€‚å¯ç”¨äº é‡‡æ ·:
</code></pre><h4 id="External-Table"><a href="#External-Table" class="headerlink" title="External Table"></a>External Table</h4><pre><code>External Table æŒ‡å‘**å·²ç»åœ¨ HDFS ä¸­å­˜åœ¨çš„æ•°æ®**, å¯ä»¥åˆ›å»º Partitionã€‚
</code></pre><p>â€‹    </p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/18/hiveIntro/" data-id="cj6xjfezu000mtsjogoyqdbxy" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-MyTopKClass" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/16/MyTopKClass/">MyTopKClass</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/16/MyTopKClass/" class="article-date"><time datetime="2017-08-16T00:30:08.000Z" itemprop="datePublished">2017-08-16</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>ç¼–å†™MRä»»æ‰¾å‡ºå‰3ä¸ªæœ€å¤§çš„æ•°å­—:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.DataInput;</div><div class="line"><span class="keyword">import</span> java.io.DataOutput;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.URI;</div><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.WritableComparable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//å¹¶éæ¯ä¸ªæ“ä½œéƒ½éœ€è¦reduce</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTopKClass</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span>  String INPUT_PATH = <span class="string">"hdfs://192.168.178.128:9000/input/topk.txt"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span>  String OUTPUT_PATH = <span class="string">"hdfs://192.168.178.128:9000/output03"</span>;</div><div class="line">	</div><div class="line"></div><div class="line">	</div><div class="line">	<span class="comment">// mapper</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTopKMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>,<span class="title">Text</span>,<span class="title">IntWritable</span>,<span class="title">NullWritable</span>&gt;</span>&#123;</div><div class="line">		<span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</div><div class="line">		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, IntWritable, NullWritable&gt;.Context context)</span></span></div><div class="line"><span class="function">				<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">			<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">			String line = value.toString().trim();</div><div class="line">			<span class="keyword">if</span>(line.length()!=<span class="number">0</span>)&#123;</div><div class="line">				Arrays.sort(a);</div><div class="line">				<span class="keyword">int</span> input = Integer.parseInt(line);</div><div class="line">				a[<span class="number">0</span>] = a[<span class="number">0</span>] &lt; input? input : a[<span class="number">0</span>];</div><div class="line">			&#125;</div><div class="line">			System.out.println(<span class="string">"mapping"</span>);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">(Mapper&lt;LongWritable, Text, IntWritable, NullWritable&gt;.Context context)</span></span></div><div class="line"><span class="function">				<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i : a)&#123;</div><div class="line">				System.out.println(<span class="string">"in map(),writing "</span>+i);</div><div class="line">				context.write(<span class="keyword">new</span> IntWritable(i),NullWritable.get());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//å°è¯•ä½¿ç”¨reducerä½¿å…¶å€’åºè¾“å‡º</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTopKReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">IntWritable</span>, <span class="title">NullWritable</span>, <span class="title">IntWritable</span>, <span class="title">IntWritable</span>&gt;</span>&#123;</div><div class="line">		</div><div class="line">		<span class="keyword">int</span>[] nums = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</div><div class="line">		<span class="keyword">int</span> i= <span class="number">0</span>;</div><div class="line">		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(IntWritable arg0, Iterable&lt;NullWritable&gt; arg1,</span></span></div><div class="line"><span class="function"><span class="params">				Reducer&lt;IntWritable, NullWritable, IntWritable, IntWritable&gt;.Context arg2)</span></span></div><div class="line"><span class="function">						<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">			nums[i++] = arg0.get();</div><div class="line">		&#125;	</div><div class="line">		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">(Reducer&lt;IntWritable, NullWritable, IntWritable, IntWritable&gt;.Context context)</span></span></div><div class="line"><span class="function">				<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">			Arrays.sort(nums);</div><div class="line">			<span class="keyword">int</span> topk = <span class="number">1</span> ;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = nums.length-<span class="number">1</span> ; i &gt;= <span class="number">0</span> ; i--) &#123;</div><div class="line">				context.write(<span class="keyword">new</span> IntWritable(topk++), <span class="keyword">new</span> IntWritable(nums[i]));</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		</div><div class="line">		<span class="comment">// ä½œä¸šå‰çš„å‡†å¤‡</span></div><div class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</div><div class="line">		FileSystem fs = FileSystem.get(URI.create(OUTPUT_PATH),conf);</div><div class="line">		<span class="comment">// æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯åˆ™ä½†åˆ é™¤ä¹‹</span></div><div class="line">		<span class="keyword">if</span>(fs.exists(<span class="keyword">new</span> Path(OUTPUT_PATH)))&#123;</div><div class="line">			fs.delete(<span class="keyword">new</span> Path(OUTPUT_PATH));</div><div class="line">		&#125;</div><div class="line">			</div><div class="line">		</div><div class="line">		<span class="comment">//ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºJob</span></div><div class="line">		Job job = <span class="keyword">new</span> Job(conf,<span class="string">"myjob"</span>);</div><div class="line">		</div><div class="line">		<span class="comment">//è®¾ç½®Job,mapper,reducer,combiner(optional)</span></div><div class="line">		job.setJarByClass(MyTopKClass.class);</div><div class="line">		job.setMapperClass(MyTopKMapper.class);</div><div class="line">		job.setReducerClass(MyTopKReducer.class);</div><div class="line">		<span class="comment">//job.setCombinerClass(MySortReducer.class);</span></div><div class="line">		</div><div class="line">		job.setMapOutputKeyClass(IntWritable.class);</div><div class="line">		job.setMapOutputValueClass(NullWritable.class);</div><div class="line">		</div><div class="line">		<span class="comment">//è®¾ç½®Outputç±»å‹</span></div><div class="line">		job.setOutputKeyClass(IntWritable.class);</div><div class="line">		job.setOutputValueClass(IntWritable.class);</div><div class="line">		</div><div class="line">		</div><div class="line">		FileInputFormat.addInputPath(job,<span class="keyword">new</span> Path(INPUT_PATH));</div><div class="line">		FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(OUTPUT_PATH));</div><div class="line">		</div><div class="line">		<span class="comment">//æœ€åä¸€æ­¥</span></div><div class="line">		job.waitForCompletion(<span class="keyword">true</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/16/MyTopKClass/" data-id="cj6xjfeyy0009tsjogoibfdzf" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-hadoopMRAdv" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/15/hadoopMRAdv/">hadoopé«˜çº§</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/15/hadoopMRAdv/" class="article-date"><time datetime="2017-08-15T11:39:30.000Z" itemprop="datePublished">2017-08-15</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="MapReduceçš„å…·ä½“è¿‡ç¨‹"><a href="#MapReduceçš„å…·ä½“è¿‡ç¨‹" class="headerlink" title="MapReduceçš„å…·ä½“è¿‡ç¨‹"></a>MapReduceçš„å…·ä½“è¿‡ç¨‹</h2><p>â€‹    MapReduceçš„å·¥ä½œæµç¨‹æ¶‰åŠåˆ°5ä¸ªå°æµç¨‹ï¼šinputï¼Œsplittingï¼Œ<strong>mapping</strong>ï¼Œshufflingï¼Œ<strong>reducing</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2017/08/15/hadoopMRAdv/MRProcess.tiff" alt=""></p>
<h3 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h3><p>â€‹    åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªç±»<code>InputFormat</code>å’Œ<code>InputSplit</code>ã€‚</p>
<h4 id="InputFormat"><a href="#InputFormat" class="headerlink" title="InputFormat"></a>InputFormat</h4><p>â€‹    é€šè¿‡ä½¿ç”¨InputFormatï¼ŒMapReduceæ¡†æ¶å¯ä»¥åšåˆ°ï¼š</p>
<ol>
<li>éªŒè¯ä½œä¸šçš„è¾“å…¥çš„æ­£ç¡®æ€§ï¼›</li>
<li>æŠŠ<strong>è¾“å…¥æ–‡ä»¶</strong>åˆ‡åˆ†æˆå¤šä¸ª<strong>é€»è¾‘InputSplits</strong>ï¼Œå¹¶æŠŠæ¯ä¸€ä¸ªInputSplitåˆ†åˆ«åˆ†å‘ç»™ä¸€ä¸ª<strong>å•ç‹¬çš„MapperTask</strong>ï¼›</li>
<li><p>æä¾›RecordReaderçš„å®ç°ï¼Œè¿™ä¸ªRecordReaderä»æŒ‡å®šçš„InputSplitä¸­æ­£ç¡®è¯»å‡ºä¸€æ¡ä¸€æ¡çš„ï¼«ï¼ï¼¶å¯¹ï¼Œ~è¿™äº› ï¼«ï¼ï¼¶å¯¹å°†ç”±æˆ‘ä»¬å†™çš„Mapperæ–¹æ³•å¤„ç†~ ã€‚</p>
<p>å½“æ•°æ®ä¼ é€ç»™mapæ—¶ï¼Œmapä¼šå°†è¾“å…¥åˆ†ç‰‡ä¼ é€åˆ°InputFormatï¼ŒInputFormatåˆ™è°ƒç”¨æ–¹æ³•<code>getRecordReader()</code>ç”Ÿæˆ<code>RecordReader</code>ï¼ŒRecordReaderå†é€šè¿‡<code>creatKey()</code>ã€<code>creatValue()</code>æ–¹æ³•åˆ›å»ºå¯ä¾›mapå¤„ç†çš„ä¸€ä¸ªä¸€ä¸ªçš„<key,value>å¯¹ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>InputFormat()</code>æ–¹æ³•æ˜¯ç”¨æ¥<strong>ç”Ÿæˆå¯ä¾›mapå¤„ç†çš„<key,value>å¯¹</key,value></strong>çš„ã€‚</key,value></p>
<p>é»˜è®¤ä½¿ç”¨çš„ITextInputFormatï¼Œåœ¨TextInputFormatä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶ï¼ˆæˆ–å…¶ä¸€éƒ¨åˆ†ï¼‰éƒ½ä¼šå•ç‹¬åœ°ä½œä¸ºmapçš„è¾“å…¥ï¼Œè€Œè¿™ä¸ªæ˜¯ç»§æ‰¿è‡ªFileInputFormatçš„ã€‚<br>ä¹‹åï¼Œæ¯è¡Œæ•°æ®éƒ½ä¼šç”Ÿæˆä¸€æ¡è®°å½•ï¼Œæ¯æ¡è®°å½•åˆ™è¡¨ç¤ºæˆ<key,value>å½¢å¼ï¼š</key,value></p>
</li>
</ol>
<ul>
<li>keyå€¼æ˜¯æ¯ä¸ªæ•°æ®çš„è®°å½•åœ¨æ•°æ®åˆ†ç‰‡ä¸­<strong>å­—èŠ‚åç§»é‡</strong>ï¼Œæ•°æ®ç±»å‹LongWritableï¼›</li>
<li>valueå€¼æ˜¯æ¯è¡Œçš„å†…å®¹ï¼Œæ•°æ®ç±»å‹æ˜¯Textã€‚</li>
</ul>
<h4 id="å…³äºinputSplit"><a href="#å…³äºinputSplit" class="headerlink" title="å…³äºinputSplit"></a>å…³äºinputSplit</h4><p>â€‹    ä»»ä½•åˆ†å‰²æ“ä½œçš„å®ç°éƒ½ç»§æ‰¿è‡ªApacheæŠ½è±¡åŸºç±»â€”â€”InputSplitï¼Œå®ƒå®šä¹‰äº†åˆ†å‰²çš„é•¿åº¦åŠä½ç½®ã€‚<br>â€‹    InputSplitæ˜¯hadoopå®šä¹‰çš„ç”¨æ¥ä¼ é€ç»™æ¯ä¸ªå•ç‹¬çš„mapçš„æ•°æ®ï¼ŒInputSplitå­˜å‚¨çš„<strong>å¹¶éæ•°æ®æœ¬èº«</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>åˆ†ç‰‡é•¿åº¦</strong>å’Œä¸€ä¸ª<strong>è®°å½•æ•°æ®ä½ç½®çš„æ•°ç»„</strong>ã€‚ç”ŸæˆInputSplitçš„æ–¹æ³•å¯ä»¥é€šè¿‡InputFormat()æ¥è®¾ç½®ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="http://blog.csdn.net/zolalad/article/details/12653093" target="_blank" rel="external">MapReduceä¸­InputFormatå’ŒInputSplitè§£è¯» - zolaladçš„ä¸“æ         - CSDNåšå®¢</a></li>
</ol>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p><img src="/2017/08/15/hadoopMRAdv/mapstages.tiff" alt=""></p>
<h4 id="Combiner"><a href="#Combiner" class="headerlink" title="Combiner"></a>Combiner</h4><p>â€‹    æ¯ä¸€ä¸ªmapéƒ½å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æœ¬åœ°è¾“å‡ºï¼ŒCombinerçš„ä½œç”¨å°±æ˜¯å¯¹mapç«¯ çš„è¾“å‡ºå…ˆåšä¸€æ¬¡åˆå¹¶ï¼Œä»¥å‡å°‘åœ¨mapå’ŒreduceèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“é‡ï¼Œ ä»¥æé«˜ç½‘ç»œIOæ€§èƒ½ã€‚</p>
<p>â€‹    Combinerçš„ä½œç”¨</p>
<ol>
<li>Combinerå®ç°<strong>æœ¬åœ°key</strong>çš„èšåˆï¼Œå¯¹mapè¾“å‡ºçš„keyæ’åºvalueè¿›è¡Œè¿­ä»£ï¼›</li>
<li>Combinerè¿˜æœ‰æœ¬åœ°reduceåŠŸèƒ½ï¼ˆå…¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªreduceï¼‰</li>
</ol>
<p>Combinerä½œç”¨å›¾è§£ï¼š<br><img src="/2017/08/15/hadoopMRAdv/combiner.tiff" alt=""><br>å¯ä»¥çœ‹åˆ°ï¼Œcombineræ˜¯åœ¨åˆ†åŒºä¹‹å‰å¼€å§‹å·¥ä½œçš„ã€‚</p>
<p>â€‹    Combinerçš„ä½¿ç”¨æ–¹æ³•<br>åœ¨mainæ–¹æ³•é‡Œï¼Œä½¿ç”¨ä¸€ä¸‹æ–¹æ³•æŒ‡å®šæŸä¸ªjobçš„combiner</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">job.setCombinerClass(MyReducer.class);</div></pre></td></tr></table></figure>
<h4 id="Partitioner"><a href="#Partitioner" class="headerlink" title="Partitioner"></a>Partitioner</h4><p>â€‹    MapReduceçš„ä½¿ç”¨è€…é€šå¸¸ä¼šæŒ‡å®šReduceä»»åŠ¡å’ŒReduceä»»åŠ¡è¾“å‡ºæ–‡ä»¶çš„æ•°é‡ï¼ˆRï¼‰ã€‚<br>â€‹    ç”¨æˆ·åœ¨ä¸­é—´keyä¸Šä½¿ç”¨åˆ†åŒºå‡½æ•°æ¥å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œä¹‹ååœ¨è¾“å…¥åˆ°åç»­ä»»åŠ¡æ‰§è¡Œè¿›ç¨‹ã€‚ä¸€ä¸ªé»˜è®¤çš„åˆ†åŒºå‡½æ•°å¼ä½¿ç”¨hashæ–¹æ³•ï¼ˆæ¯”å¦‚å¸¸è§çš„ï¼šhash(key) mod Rï¼‰è¿›è¡Œåˆ†åŒºã€‚hashæ–¹æ³•èƒ½å¤Ÿäº§ç”Ÿéå¸¸å¹³è¡¡çš„åˆ†åŒºã€‚</p>
<p>åˆ†åŒºPartitionerä¸»è¦ä½œç”¨åœ¨äºä»¥ä¸‹ä¸¤ç‚¹</p>
<ol>
<li>æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œäº§ç”Ÿå¤šä¸ªè¾“å‡ºæ–‡ä»¶</li>
<li>å¤šä¸ªreduceä»»åŠ¡å¹¶å‘è¿è¡Œï¼Œæé«˜æ•´ä½“jobçš„è¿è¡Œæ•ˆç‡</li>
</ol>
<h3 id="Shuffling"><a href="#Shuffling" class="headerlink" title="Shuffling"></a>Shuffling</h3><h4 id="shuffleçš„å®šä¹‰"><a href="#shuffleçš„å®šä¹‰" class="headerlink" title="shuffleçš„å®šä¹‰"></a>shuffleçš„å®šä¹‰</h4><p>åœ¨ã€ŠHadoopæƒå¨æŒ‡å—ã€‹ä¸­ï¼Œå¯¹Shuffleçš„è§£é‡Šå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>MapReduce makes the guarantee that the input to every reducer is sorted by key. The process by which the system performs the sortâ€”and transfers the map outputs to the reducers as inputsâ€”is known as the shuffle. </p>
</blockquote>
<p>â€‹    MapReduceä¿è¯æ¯ä¸€ä¸ªreducerçš„è¾“å…¥<strong>éƒ½æ˜¯å·²ç»æŒ‰ç…§keyæ‹è¿‡åºçš„</strong>ã€‚è¿™ä¸ª<u>ç”±ç³»ç»Ÿæ‰§è¡Œçš„å°†mapperçš„è¾“å‡ºæ’åºåä¼ è¾“åˆ°reducerä½œä¸ºå…¶è¾“å…¥çš„è¿‡ç¨‹</u>ç§°ä¸ºshuffleï¼ˆæ´—ç‰Œï¼‰ã€‚<br>â€‹    ä»å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œsortè¿™ä¸ªåŠ¨ä½œå‘ç”Ÿåœ¨shuffleè¿™ä¸ªé˜¶æ®µã€‚<br>â€‹    è¿™ä¸ªè¿‡ç¨‹æœ‰<strong>æ’åº</strong>ï¼Œä¹Ÿæœ‰<strong>å¤åˆ¶</strong>ã€‚</p>
<p>shuffleå’Œsortåœ¨mrè¿‡ç¨‹ä¸­çš„ä½“ç°å¦‚ä¸‹å›¾ï¼š<br><img src="/2017/08/15/hadoopMRAdv/shufflingAndSort.png" alt=""><br>è¾“å…¥ï¼Œmapï¼Œåˆ†åŒºï¼Œæ’åºï¼Œåˆ†ç»„ï¼Œå­˜åˆ°ç£ç›˜<br>fetchï¼Œsortï¼Œcombineï¼Œreduce    </p>
<h4 id="Shuffleä¸­çš„Mapç«¯ï¼š"><a href="#Shuffleä¸­çš„Mapç«¯ï¼š" class="headerlink" title="Shuffleä¸­çš„Mapç«¯ï¼š"></a>Shuffleä¸­çš„Mapç«¯ï¼š</h4><p><img src="/2017/08/15/hadoopMRAdv/mapInShuffle.png" alt=""><br>å¯¹ä¸Šå›¾çš„è§£é‡Šå¦‚ä¸‹ï¼š<br>â€‹    åœ¨mapç«¯ï¼Œå…ˆæ˜¯InputSplitï¼Œåœ¨InputSplitä¸­å«æœ‰DataNodeä¸­çš„æ•°æ®ï¼Œæ¯ ä¸ªInputSplitéƒ½ä¼šåˆ†é…ä¸€ä¸ªMapperä»»åŠ¡ï¼ŒMapperä»»åŠ¡ç»“æŸåäº§ <k2ï¼Œv2>çš„è¾“å‡ºï¼Œ <strong>è¿™äº›è¾“å‡ºå…ˆå­˜æ”¾åœ¨ç¼“å­˜ä¸­</strong>ï¼Œæ¯ä¸ªmapæœ‰ ä¸ªç¯å½¢å†…å­˜ç¼“å†²åŒºï¼Œ äºå­˜å‚¨ä»»åŠ¡çš„ è¾“å‡ºã€‚é»˜è®¤ä¸º100MB(io.sort.mbå±æ€§)ï¼Œ æ—¦è¾¾åˆ°é˜€å€¼0.8(<code>io.sort.spill.percent</code>)ï¼Œ ä¸€ä¸ªåå°çº¿ç¨‹å°±æŠŠå†…å®¹å†™åˆ°(spill)Linux<strong>æœ¬åœ°ç£ç›˜</strong>ä¸­çš„æŒ‡å®šç›®å½•(mapred.local.dir)ä¸‹çš„æ–°å»ºçš„ä¸€ä¸ªæº¢å‡ºå†™æ–‡ä»¶ã€‚<br>â€‹    å†™ç£ç›˜å‰ï¼Œ<strong>è¦è¿› partitionã€sortå’Œcombineç­‰æ“ä½œ</strong>ã€‚é€šè¿‡åˆ†åŒºï¼Œå°†åŒç±»å‹çš„æ•°æ®åˆ†å¼€å¤„ ï¼Œä¹‹åå¯¹åŒåˆ†åŒºçš„æ•°æ®è¿›è¡Œæ’åºï¼Œå¦‚æœæœ‰Combinerï¼Œè¿˜è¦å¯¹æ’åºåçš„æ•°æ®è¿› combineã€‚ç­‰æœ€åè®°å½•å†™å®Œï¼Œå°†å…¨éƒ¨æº¢å‡º ä»¶åˆå¹¶ä¸º ä¸ªåˆ†åŒºä¸” æ’åºçš„ ä»¶<br>æœ€åå°†ç£ç›˜ä¸­çš„æ•°æ®é€åˆ°Reduceä¸­ï¼Œå›¾ä¸­Mapè¾“å‡ºæœ‰ä¸‰ä¸ªåˆ†åŒºï¼Œæœ‰ä¸€ä¸ªåˆ†åŒºæ•°æ®è¢«é€åˆ°å›¾ç¤ºçš„Reduceä»»åŠ¡ä¸­ï¼Œå‰©ä¸‹çš„ä¸¤ä¸ªåˆ†åŒºè¢«é€åˆ°å…¶ä»–Reducerä»»åŠ¡ä¸­ã€‚  å›¾ç¤ºçš„Reducerä»»åŠ¡çš„å…¶ä»–çš„ä¸‰ä¸ªè¾“ åˆ™æ¥å…¶ä»–èŠ‚ç‚¹çš„Mapè¾“å‡ºã€‚</k2ï¼Œv2></p>
<p>ä¸€äº›è¦ç‚¹ï¼š</p>
<ol>
<li>mapçš„è¾“å‡ºå­˜åœ¨ä¸€ä¸ªç¯å½¢å†…å­˜ç¼“å†²åŒºï¼Œå†…å®¹è¶…è¿‡80%çš„æ—¶å€™ï¼Œå†…å­˜çš„å†…å®¹ä¼šè¢«<strong>æ–°å¼€çš„çº¿ç¨‹</strong>å†™å…¥åˆ°HDFSï¼›</li>
<li>çº¿ç¨‹æ ¹æ®æ•°æ®æœ€ç»ˆè¢«é€åˆ°çš„recuderï¼Œå°†<strong>æ•°æ®åˆ’åˆ†ä¸ºç›¸åº”çš„åˆ†åŒº</strong>ï¼›</li>
<li>åœ¨æ¯ä¸ªåˆ†åŒºä¸­ï¼Œåå°çº¿ç¨‹æŒ‰ç…§keyè¿›è¡Œå†…æ’åºï¼Œæ­¤æ—¶è‹¥æ˜¯æœ‰ä¸€ä¸ªcombinerï¼Œcombinerå°†åŸºäºæ’åºåçš„è¾“å‡ºæ¥è¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æº¢å†™æ–‡ä»¶è¢«å†™å…¥åˆ°ç£ç›˜<strong>ä¹‹å‰</strong>è¿è¡Œäº†combinerï¼›</li>
<li>ä¸€ä¸ªmapæœ‰å¯èƒ½ä¼šäº§ç”Ÿè‹¥å¹²ä¸ªæº¢å†™æ–‡ä»¶ï¼ˆspill fileï¼‰ï¼Œæœ€ç»ˆæº¢å†™æ–‡ä»¶ä¼šè¢«<strong>åˆå¹¶</strong>æˆä¸€ä¸ª<strong>å·²åˆ†åŒº</strong>ä¸”<strong>å·²æ’åº</strong>çš„æ–‡ä»¶ã€‚</li>
<li>mapçš„è¾“å‡ºæ–‡ä»¶ä½äºå…¶tasktrackerçš„<strong>æœ¬åœ°ç£ç›˜</strong>ã€‚</li>
</ol>
<p>â€‹    </p>
<h4 id="Shuffleä¸­çš„Reduceç«¯"><a href="#Shuffleä¸­çš„Reduceç«¯" class="headerlink" title="Shuffleä¸­çš„Reduceç«¯"></a>Shuffleä¸­çš„Reduceç«¯</h4><p><img src="/2017/08/15/hadoopMRAdv/ReduceInShuffle.tiff" alt=""><br>â€‹    Copyé˜¶æ®µ:Reduceré€šè¿‡Httpå¼å¾—åˆ°è¾“å‡ºæ–‡ä»¶çš„åˆ†åŒºã€‚reduceç«¯å¯èƒ½ä»nä¸ªmapçš„ç»“æœä¸­è·å–æ•°æ®ï¼Œ è¿™äº›mapçš„æ‰§è¡Œé€Ÿåº¦ä¸å°½ç›¸åŒï¼Œ å½“å…¶ä¸­ä¸€ä¸ªmapè¿è¡Œç»“æŸæ—¶ï¼Œreduceå°±ä¼šä»JobTrackerä¸­è·å–è¯¥ä¿¡æ¯ã€‚mapè¿è¡Œç»“æŸåTaskTrackerä¼šå¾—åˆ°æ¶ˆæ¯ï¼Œè¿›è€Œå°†æ¶ˆæ¯æ±‡æŠ¥ç»™JobTrackerï¼Œreduceå®šæ—¶ä» JobTrackerè·å–è¯¥ä¿¡æ¯ï¼Œreduceç«¯é»˜è®¤æœ‰5ä¸ªæ•°æ®å¤åˆ¶çº¿ç¨‹ä»mapç«¯å¤åˆ¶æ•°æ®ï¼›<br>â€‹    Mergeé˜¶æ®µ:å¦‚æœå½¢æˆå¤šä¸ªç£ç›˜æ–‡ä»¶ä¼šè¿›è¡Œåˆå¹¶ã€‚ä»mapç«¯å¤åˆ¶æ¥çš„æ•°æ® å…ˆå†™åˆ°reduceç«¯çš„<strong>ç¼“å­˜</strong>ä¸­ï¼ŒåŒæ ·ç¼“å­˜å ç”¨<strong>åˆ°è¾¾ä¸€å®šé˜ˆå€¼åä¼šå°†æ•°æ®å†™åˆ°ç£ç›˜ä¸­</strong>ï¼Œ<strong>åŒæ ·ä¼šè¿› partitionã€combineã€æ’åºç­‰è¿‡ç¨‹</strong>ã€‚å¦‚æœå½¢æˆå¤šä¸ªç£ç›˜ æ–‡ä»¶è¿˜ä¼šè¿›è¡Œåˆå¹¶ï¼Œ<strong>æœ€åä¸€æ¬¡åˆå¹¶çš„ç»“æœ</strong>ä½œä¸ºreduceçš„è¾“å…¥è€Œä¸æ˜¯å†™åˆ°ç£ç›˜ä¸­ï¼›</p>
<p>ä¸€äº›è¦ç‚¹ï¼š</p>
<ol>
<li>åªè¦æœ‰ä¸€ä¸ªmapä»»åŠ¡å®Œæˆäº†ï¼Œreduceä»»åŠ¡å°±å¼€å§‹å¤åˆ¶è¯¥mapçš„è¾“å‡º</li>
<li>reduceré€šè¿‡<strong>HTTP</strong>å¾—åˆ°è¾“å‡ºæ–‡ä»¶çš„<strong>åˆ†åŒº</strong>ã€‚</li>
<li>åœ¨å°†æ•°æ®ä»å†…å­˜å­˜åˆ°ç£ç›˜ä¸­è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥ä½¿ç”¨å„ç§<strong>å‹ç¼©</strong>ç®—æ³•äº†ï¼›</li>
</ol>
<h4 id="Shuffleè¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ä»¥ä¸‹ç‚¹"><a href="#Shuffleè¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ä»¥ä¸‹ç‚¹" class="headerlink" title="Shuffleè¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ä»¥ä¸‹ç‚¹"></a>Shuffleè¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ä»¥ä¸‹ç‚¹</h4><p>ShuffleåŒæ—¶æ¶‰åŠåˆ°Mapå’ŒReduceä¸¤ç«¯ã€‚<br>åœ¨Mapç«¯ï¼Œmapçš„æ‰€å¤„çš„èŠ‚ç‚¹ä¸Šï¼Œä¼šæœ‰ä¸€ä¸ªpartitionï¼Œcombineï¼Œsortçš„æ“ä½œï¼›<br>åœ¨Reduceç«¯ï¼ŒåŒæ ·ä¼šæœ‰partitionï¼Œcombineï¼Œsortçš„æ“ä½œï¼Œä¸è¿‡è¿™æ¬¡å‘ç”Ÿåœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸Šï¼›</p>
<h3 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h3><p><img src="/2017/08/15/hadoopMRAdv/reduce.png" alt=""><br>æ­¤å¤„ä¸»è¦æ˜¯å¯¹å—åˆ°çš„çš„<k2,v2>æ‰§è¡Œç¨‹åºå‘˜ç¼–å†™çš„reduceæ–¹æ³•ã€‚</k2,v2></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/15/hadoopMRAdv/" data-id="cj6xjfezp000itsjoz7jv4cb1" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MapReduce/">MapReduce</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-wordcount" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/15/wordcount/">wordcountçš„ç¼–å†™</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/15/wordcount/" class="article-date"><time datetime="2017-08-15T11:29:34.000Z" itemprop="datePublished">2017-08-15</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>åœ¨Eclipseåˆ›å»ºMapReduceé¡¹ç›®ï¼Œæ–°å»ºä¸€ä¸ªMyWordCountç±»ã€‚</p>
<p>ç¼–å†™ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.URI;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWordCount</span> </span>&#123;</div><div class="line">	</div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span>  String INPUT_PATH = <span class="string">"hdfs://192.168.178.128:9000/input/words.txt"</span>;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span>  String OUTPUT_PATH = <span class="string">"hdfs://192.168.178.128:9000/output01"</span>;</div><div class="line">	</div><div class="line">		<span class="comment">// mapper</span></div><div class="line">		<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt;</span>&#123;</div><div class="line">			</div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, // offset åç§»é‡</span></span></div><div class="line"><span class="function"><span class="params">					Text value,</span></span></div><div class="line"><span class="function"><span class="params">					Context context)</span></span></div><div class="line"><span class="function">							<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">				<span class="comment">//mapå¤„ç†å¼€å§‹</span></div><div class="line">				<span class="comment">//åˆ‡è¯</span></div><div class="line">				String[] lines = value.toString().split(<span class="string">"\\s+"</span>);</div><div class="line">				<span class="comment">// ä¸¾ä¸ªä¾‹å­ï¼šline x: hello world</span></div><div class="line">				<span class="comment">// å¾—åˆ°çš„ç»“æœå°±æ˜¯: (hello,1) (world,1) ï¼Œåˆ†åˆ«å†™å…¥åˆ°contextä¸­</span></div><div class="line">				<span class="keyword">for</span> (String word : lines) &#123;</div><div class="line">					context.write(<span class="keyword">new</span> Text(word), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</div><div class="line">				&#125;</div><div class="line">				System.out.println(<span class="string">"mapping......"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		</div><div class="line">		<span class="comment">//reducer</span></div><div class="line">		<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">IntWritable</span>,<span class="title">Text</span>,<span class="title">IntWritable</span>&gt;</span>&#123;</div><div class="line">			</div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, // map -&gt; sort part -&gt; reduce</span></span></div><div class="line"><span class="function"><span class="params">					Iterable&lt;IntWritable&gt; value,</span></span></div><div class="line"><span class="function"><span class="params">					Context context)</span></span></div><div class="line"><span class="function">							<span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">				</div><div class="line">				<span class="comment">// reducerå¾—åˆ°çš„keyæ˜¯å”¯ä¸€çš„</span></div><div class="line">				<span class="comment">// æ­¤å¤„ä¸¾ä¸ªä¾‹å­ï¼Œ è¯¥reducerå¤„ç†çš„keyæ˜¯ hello</span></div><div class="line">				<span class="comment">// ç›®å‰æœ‰çš„é”®å€¼å¯¹æœ‰ hello 1 </span></div><div class="line">				<span class="comment">// 				hello 1</span></div><div class="line">				<span class="comment">// 				hello 1</span></div><div class="line">				<span class="comment">//å¾—åˆ°çš„ç»“æœå°†ä¼šæ˜¯ hello 3</span></div><div class="line">				<span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line">				Iterator&lt;IntWritable&gt; it = value.iterator();</div><div class="line">				<span class="keyword">while</span>(it.hasNext())&#123;</div><div class="line">					sum += it.next().get();</div><div class="line">				&#125;</div><div class="line"> 				</div><div class="line">				<span class="comment">//å°†ç»“æœå†™å…¥åˆ°context</span></div><div class="line">				context.write(key, <span class="keyword">new</span> IntWritable(sum));	</div><div class="line">				System.out.println(<span class="string">"reducing......"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		</div><div class="line">		</div><div class="line">		</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">			</div><div class="line">			<span class="comment">// ä½œä¸šå‰çš„å‡†å¤‡</span></div><div class="line">			Configuration conf = <span class="keyword">new</span> Configuration();</div><div class="line">			FileSystem fs = FileSystem.get(URI.create(OUTPUT_PATH),conf);</div><div class="line">			<span class="comment">// æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯åˆ™ä½†åˆ é™¤ä¹‹</span></div><div class="line">			<span class="keyword">if</span>(fs.exists(<span class="keyword">new</span> Path(OUTPUT_PATH)))&#123;</div><div class="line">				fs.delete(<span class="keyword">new</span> Path(OUTPUT_PATH));</div><div class="line">			&#125;</div><div class="line">				</div><div class="line">			</div><div class="line">			<span class="comment">//ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºJob</span></div><div class="line">			Job job = <span class="keyword">new</span> Job(conf,<span class="string">"myjob"</span>);</div><div class="line">			</div><div class="line">			<span class="comment">//è®¾ç½®Job,mapper,reducer,combiner(optional)</span></div><div class="line">			job.setJarByClass(MyWordCount.class);</div><div class="line">			job.setMapperClass(MyMapper.class);</div><div class="line">			job.setReducerClass(MyReducer.class);</div><div class="line">			job.setCombinerClass(MyReducer.class);</div><div class="line">			</div><div class="line">			</div><div class="line">			<span class="comment">//è®¾ç½®Outputç±»å‹</span></div><div class="line">			job.setOutputKeyClass(Text.class);</div><div class="line">			job.setOutputValueClass(IntWritable.class);</div><div class="line">			</div><div class="line">			FileInputFormat.addInputPath(job,<span class="keyword">new</span> Path(INPUT_PATH));</div><div class="line">			FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(OUTPUT_PATH));</div><div class="line">			</div><div class="line">			<span class="comment">//æœ€åä¸€æ­¥</span></div><div class="line">			job.waitForCompletion(<span class="keyword">true</span>);</div><div class="line">			</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">34</span> WARN util.NativeCodeLoader: Unable to load <span class="keyword">native</span>-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">35</span> INFO Configuration.deprecation: session.id is deprecated. Instead, use dfs.metrics.session-id</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">35</span> INFO jvm.JvmMetrics: Initializing JVM Metrics with processName=JobTracker, sessionId=</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">36</span> WARN mapreduce.JobSubmitter: Hadoop command-line option parsing not performed. Implement the Tool <span class="class"><span class="keyword">interface</span> <span class="title">and</span> <span class="title">execute</span> <span class="title">your</span> <span class="title">application</span> <span class="title">with</span> <span class="title">ToolRunner</span> <span class="title">to</span> <span class="title">remedy</span> <span class="title">this</span>.</span></div><div class="line">17/08/15 19:37:36 WARN mapreduce.JobSubmitter: No job jar file set.  User classes may not be found. See Job or Job#setJar(String).</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">36</span> INFO input.FileInputFormat: Total input paths to process : <span class="number">1</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">36</span> INFO mapreduce.JobSubmitter: number of splits:<span class="number">1</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">36</span> INFO mapreduce.JobSubmitter: Submitting tokens <span class="keyword">for</span> job: job_local484001035_0001</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapreduce.Job: The url to track the job: http:<span class="comment">//localhost:8080/</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapreduce.Job: Running job: job_local484001035_0001</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.LocalJobRunner: OutputCommitter set in config <span class="keyword">null</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.LocalJobRunner: OutputCommitter is org.apache.hadoop.mapreduce.lib.output.FileOutputCommitter</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.LocalJobRunner: Waiting <span class="keyword">for</span> map tasks</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.LocalJobRunner: Starting task: attempt_local484001035_0001_m_000000_0</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO util.ProcfsBasedProcessTree: ProcfsBasedProcessTree currently is supported only on Linux.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.Task:  Using ResourceCalculatorProcessTree : <span class="keyword">null</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: Processing split: hdfs:<span class="comment">//192.168.178.128:9000/input/words.txt:0+86</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: (EQUATOR) <span class="number">0</span> kvi <span class="number">26214396</span>(<span class="number">104857584</span>)</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: mapreduce.task.io.sort.mb: <span class="number">100</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: soft limit at <span class="number">83886080</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: bufstart = <span class="number">0</span>; bufvoid = <span class="number">104857600</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: kvstart = <span class="number">26214396</span>; length = <span class="number">6553600</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">37</span> INFO mapred.MapTask: Map output collector <span class="class"><span class="keyword">class</span> </span>= org.apache.hadoop.mapred.MapTask$MapOutputBuffer</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapreduce.Job: Job job_local484001035_0001 running in uber mode : <span class="keyword">false</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapreduce.Job:  map <span class="number">0</span>% reduce <span class="number">0</span>%</div><div class="line">mapping......</div><div class="line">mapping......</div><div class="line">mapping......</div><div class="line">mapping......</div><div class="line">mapping......</div><div class="line">mapping......</div><div class="line">mapping......</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: </div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.MapTask: Starting flush of map output</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.MapTask: Spilling map output</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.MapTask: bufstart = <span class="number">0</span>; bufend = <span class="number">134</span>; bufvoid = <span class="number">104857600</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.MapTask: kvstart = <span class="number">26214396</span>(<span class="number">104857584</span>); kvend = <span class="number">26214352</span>(<span class="number">104857408</span>); length = <span class="number">45</span>/<span class="number">6553600</span></div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.MapTask: Finished spill <span class="number">0</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Task: Task:attempt_local484001035_0001_m_000000_0 is done. And is in the process of committing</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: map</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Task: Task <span class="string">'attempt_local484001035_0001_m_000000_0'</span> done.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: Finishing task: attempt_local484001035_0001_m_000000_0</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: map task executor complete.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: Waiting <span class="keyword">for</span> reduce tasks</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: Starting task: attempt_local484001035_0001_r_000000_0</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO util.ProcfsBasedProcessTree: ProcfsBasedProcessTree currently is supported only on Linux.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Task:  Using ResourceCalculatorProcessTree : <span class="keyword">null</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.ReduceTask: Using ShuffleConsumerPlugin: org.apache.hadoop.mapreduce.task.reduce.Shuffle@<span class="number">2</span>ae4ec62</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.MergeManagerImpl: MergerManager: memoryLimit=<span class="number">1336252800</span>, maxSingleShuffleLimit=<span class="number">334063200</span>, mergeThreshold=<span class="number">881926912</span>, ioSortFactor=<span class="number">10</span>, memToMemMergeOutputsThreshold=<span class="number">10</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.EventFetcher: attempt_local484001035_0001_r_000000_0 Thread started: EventFetcher <span class="keyword">for</span> fetching Map Completion Events</div><div class="line">17/08/15 19:37:38 INFO reduce.LocalFetcher: localfetcher#1 about to shuffle output of map attempt_local484001035_0001_m_000000_0 decomp: 95 len: 99 to MEMORY</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.InMemoryMapOutput: Read <span class="number">95</span> bytes from map-output <span class="keyword">for</span> attempt_local484001035_0001_m_000000_0</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.MergeManagerImpl: closeInMemoryFile -&gt; map-output of size: <span class="number">95</span>, inMemoryMapOutputs.size() -&gt; <span class="number">1</span>, commitMemory -&gt; <span class="number">0</span>, usedMemory -&gt;<span class="number">95</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.EventFetcher: EventFetcher is interrupted.. Returning</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: <span class="number">1</span> / <span class="number">1</span> copied.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.MergeManagerImpl: finalMerge called with <span class="number">1</span> in-memory map-outputs and <span class="number">0</span> on-disk map-outputs</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Merger: Merging <span class="number">1</span> sorted segments</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Merger: Down to the last merge-pass, with <span class="number">1</span> segments left of total size: <span class="number">88</span> bytes</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.MergeManagerImpl: Merged <span class="number">1</span> segments, <span class="number">95</span> bytes to disk to satisfy reduce memory limit</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.MergeManagerImpl: Merging <span class="number">1</span> files, <span class="number">99</span> bytes from disk</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO reduce.MergeManagerImpl: Merging <span class="number">0</span> segments, <span class="number">0</span> bytes from memory into reduce</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Merger: Merging <span class="number">1</span> sorted segments</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.Merger: Down to the last merge-pass, with <span class="number">1</span> segments left of total size: <span class="number">88</span> bytes</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO mapred.LocalJobRunner: <span class="number">1</span> / <span class="number">1</span> copied.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">38</span> INFO Configuration.deprecation: mapred.skip.on is deprecated. Instead, use mapreduce.job.skiprecords</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line">reducing......</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapreduce.Job:  map <span class="number">100</span>% reduce <span class="number">0</span>%</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.Task: Task:attempt_local484001035_0001_r_000000_0 is done. And is in the process of committing</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.LocalJobRunner: <span class="number">1</span> / <span class="number">1</span> copied.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.Task: Task attempt_local484001035_0001_r_000000_0 is allowed to commit now</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO output.FileOutputCommitter: Saved output of task <span class="string">'attempt_local484001035_0001_r_000000_0'</span> to hdfs:<span class="comment">//192.168.178.128:9000/output01/_temporary/0/task_local484001035_0001_r_000000</span></div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.LocalJobRunner: reduce &gt; reduce</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.Task: Task <span class="string">'attempt_local484001035_0001_r_000000_0'</span> done.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.LocalJobRunner: Finishing task: attempt_local484001035_0001_r_000000_0</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">39</span> INFO mapred.LocalJobRunner: reduce task executor complete.</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">40</span> INFO mapreduce.Job:  map <span class="number">100</span>% reduce <span class="number">100</span>%</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">40</span> INFO mapreduce.Job: Job job_local484001035_0001 completed successfully</div><div class="line"><span class="number">17</span>/<span class="number">08</span>/<span class="number">15</span> <span class="number">19</span>:<span class="number">37</span>:<span class="number">40</span> INFO mapreduce.Job: Counters: <span class="number">35</span></div><div class="line">	File System Counters</div><div class="line">		FILE: Number of bytes read=<span class="number">562</span></div><div class="line">		FILE: Number of bytes written=<span class="number">491225</span></div><div class="line">		FILE: Number of read operations=<span class="number">0</span></div><div class="line">		FILE: Number of large read operations=<span class="number">0</span></div><div class="line">		FILE: Number of write operations=<span class="number">0</span></div><div class="line">		HDFS: Number of bytes read=<span class="number">172</span></div><div class="line">		HDFS: Number of bytes written=<span class="number">65</span></div><div class="line">		HDFS: Number of read operations=<span class="number">15</span></div><div class="line">		HDFS: Number of large read operations=<span class="number">0</span></div><div class="line">		HDFS: Number of write operations=<span class="number">6</span></div><div class="line">	Map-Reduce Framework</div><div class="line">		Map input records=<span class="number">7</span></div><div class="line">		Map output records=<span class="number">12</span></div><div class="line">		Map output bytes=<span class="number">134</span></div><div class="line">		Map output materialized bytes=<span class="number">99</span></div><div class="line">		Input split bytes=<span class="number">108</span></div><div class="line">		Combine input records=<span class="number">12</span></div><div class="line">		Combine output records=<span class="number">7</span></div><div class="line">		Reduce input groups=<span class="number">7</span></div><div class="line">		Reduce shuffle bytes=<span class="number">99</span></div><div class="line">		Reduce input records=<span class="number">7</span></div><div class="line">		Reduce output records=<span class="number">7</span></div><div class="line">		Spilled Records=<span class="number">14</span></div><div class="line">		Shuffled Maps =<span class="number">1</span></div><div class="line">		Failed Shuffles=<span class="number">0</span></div><div class="line">		Merged Map outputs=<span class="number">1</span></div><div class="line">		<span class="function">GC time <span class="title">elapsed</span> <span class="params">(ms)</span></span>=<span class="number">0</span></div><div class="line">		<span class="function">Total committed heap <span class="title">usage</span> <span class="params">(bytes)</span></span>=<span class="number">475004928</span></div><div class="line">	Shuffle Errors</div><div class="line">		BAD_ID=<span class="number">0</span></div><div class="line">		CONNECTION=<span class="number">0</span></div><div class="line">		IO_ERROR=<span class="number">0</span></div><div class="line">		WRONG_LENGTH=<span class="number">0</span></div><div class="line">		WRONG_MAP=<span class="number">0</span></div><div class="line">		WRONG_REDUCE=<span class="number">0</span></div><div class="line">	File Input Format Counters </div><div class="line">		Bytes Read=<span class="number">86</span></div><div class="line">	File Output Format Counters </div><div class="line">		Bytes Written=<span class="number">65</span></div></pre></td></tr></table></figure>
<p>è¾“å…¥æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hello liuchengwu</div><div class="line">hello liulao</div><div class="line">hello dora</div><div class="line">hello liu</div><div class="line">hello hadoop</div><div class="line">helloWorld</div><div class="line">helloWorld</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">dora	1</div><div class="line">hadoop	1</div><div class="line">hello	5</div><div class="line">helloWorld	2</div><div class="line">liu	1</div><div class="line">liuchengwu	1</div><div class="line">liulao	1</div></pre></td></tr></table></figure>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/15/wordcount/" data-id="cj6xjff01000stsjowkr6esmr" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MapReduce/">MapReduce</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ä»£ç /">ä»£ç </a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-Hadoop-MapReduce" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/14/Hadoop-MapReduce/">Hadoop_MapReduce</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/14/Hadoop-MapReduce/" class="article-date"><time datetime="2017-08-14T14:39:19.000Z" itemprop="datePublished">2017-08-14</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä»€ä¹ˆæ˜¯MapReduce"><a href="#ä»€ä¹ˆæ˜¯MapReduce" class="headerlink" title="ä»€ä¹ˆæ˜¯MapReduce"></a>ä»€ä¹ˆæ˜¯MapReduce</h2><p>â€‹    MapReduceæ˜¯ä¸€ä¸ªç¼–ç¨‹æ¨¡å‹ï¼Œç”¨ä»¥è¿›è¡Œå¤§æ•°æ®é‡çš„è®¡ç®—ã€‚<br>â€‹    Hadoop MapReduceæ˜¯ä¸€ä¸ªè½¯ä»¶æ¡†æ¶ï¼ŒåŸºäºè¯¥æ¡†æ¶èƒ½å¤Ÿ å®¹æ˜“åœ°ç¼–å†™åº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¿è¡Œåœ¨ç”±ä¸Šåƒä¸ªå•†ç”¨æœºå™¨ç»„æˆçš„å¤§é›†ç¾¤ä¸Šï¼Œå¹¶ä»¥ä¸€ç§<strong>å¯é çš„</strong>ï¼Œ<strong>å…·æœ‰å®¹é”™èƒ½åŠ›</strong>çš„æ–¹å¼å¹¶è¡Œåœ°å¤„ç†ä¸ŠTBçº§åˆ«çš„æµ·é‡æ•°æ®é›†ã€‚</p>
<h3 id="MapReduceçš„ç‰¹ç‚¹"><a href="#MapReduceçš„ç‰¹ç‚¹" class="headerlink" title="MapReduceçš„ç‰¹ç‚¹"></a>MapReduceçš„ç‰¹ç‚¹</h3><p>MapReduceçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>è½¯ä»¶æ¡†æ¶</li>
<li>å¹¶è¡Œå¤„ç† </li>
<li>å¯é ä¸”å®¹é”™ </li>
<li>å¤§è§„æ¨¡é›†ç¾¤ </li>
<li>æµ·é‡æ•°æ®é›†</li>
</ol>
<h3 id="MapReduceçš„å¤„ç†æ–¹å¼"><a href="#MapReduceçš„å¤„ç†æ–¹å¼" class="headerlink" title="MapReduceçš„å¤„ç†æ–¹å¼"></a>MapReduceçš„å¤„ç†æ–¹å¼</h3><p>â€‹    MapReduceå¤„ç†å·¥ä½œçš„ä¸»è¦æ€æƒ³æ˜¯ï¼š<strong>åˆ†è€Œæ²»ä¹‹</strong>ã€‚<br>â€‹    æ•´ä¸ªå·¥ä½œæµç¨‹ä¸­æ¶‰åŠåˆ°4ä¸ªå®ä½“ï¼šå®¢æˆ·ç«¯ï¼ŒJobTrackerï¼ŒTaskTrackerï¼ŒHDFSã€‚<br>â€‹    åœ¨è¿™å››ä¸ªå®ä½“ä¸­ï¼Œå’Œç›®å‰çš„ç¼–ç¨‹æœ‰å…³çš„å°±æ˜¯<strong>å®¢æˆ·ç«¯</strong>ï¼Œç¼–å†™çš„å°±æ˜¯MapReduceç¨‹åºã€‚<br>â€‹    è¯¥å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2017/08/14/Hadoop-MapReduce/runAMapReduceJob.jpg" alt=""></p>
<p>â€‹    å®¢æˆ·ç«¯ï¼šæäº¤MapReduceå·¥ä½œï¼›<br>â€‹    JobTrackerï¼šåè°ƒä½œä¸šçš„è¿è¡Œï¼Œåªæœ‰ä¸€ä¸ªï¼›<br>â€‹    TaskTrackerï¼šå¤„ç†ä½œä¸šåˆ’åˆ†åçš„ä»»åŠ¡ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼›<br>â€‹    HDFSï¼šåœ¨å…¶ä»–å®ä½“ä¹‹é—´<strong>å…±äº«</strong>ä½œä¸šæ–‡ä»¶ï¼›<br>â€¼ï¸å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯è¦<strong>ç¼–å†™mapreduceç¨‹åº</strong>ï¼Œé…ç½®å¥½mapreduceçš„ä½œä¸šä¹Ÿå°±æ˜¯<strong>job</strong>ï¼Œ æ¥ä¸‹æ¥å‘JobTrackerè¯·æ±‚ä¸€ä¸ªjobIDï¼Œè¿™ä¸ªæ—¶å€™JobTrackerä¸ºè¯¥jobä»»åŠ¡åˆ†é…ä¸€ä¸ªæ–°çš„IDå€¼ï¼›</li>
<li>æ¥ç€JokTrackerè¿›è¡Œå„ç§æ£€æŸ¥å’Œè®¡ç®—ï¼Œä¾‹å¦‚ï¼Œ<strong>è¾“å‡ºç›®å½•æ˜¯å¦å­˜åœ¨</strong>ï¼ˆå­˜åœ¨åˆ™æ— æ³•è¿è¡Œï¼‰ï¼Œ<strong>è¾“å…¥ç›®å½•æ˜¯å¦å­˜åœ¨</strong>ï¼ˆä¸å­˜åœ¨åˆ™ä¸å¯è¿è¡Œï¼‰ï¼Œ<strong>æ®è¾“å…¥è®¡ç®—è¾“å…¥åˆ†ç‰‡(Input Split)</strong>ï¼Œå®Œæˆä¹‹åJobTrackerä¸ºJobåˆ†é…èµ„æºï¼Œå®¢æˆ·ç«¯å‘JobTrackeræäº¤ä½œä¸š(submitJob)ï¼›</li>
<li>JobTrackeråˆå§‹åŒ–ä½œä¸šï¼Œåˆå§‹åŒ–ä¸»è¦åšçš„æ˜¯<strong>å°†Jobæ”¾å…¥ä¸€ä¸ªå†…éƒ¨çš„é˜Ÿåˆ—</strong>ï¼Œè®©é…ç½®å¥½çš„<strong>ä½œä¸šè°ƒåº¦å™¨</strong>èƒ½è°ƒåº¦åˆ°è¿™ä¸ªä½œä¸šã€‚ä½œä¸šè°ƒåº¦å™¨ä¼šåˆå§‹åŒ–è¿™ä¸ªjobï¼Œåˆå§‹åŒ–å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„jobå¯¹è±¡(å°è£…ä»»åŠ¡å’Œè®°å½•ä¿¡æ¯)ï¼Œ ä»¥ä¾¿JobTrackerè·Ÿè¸ªjobçš„çŠ¶æ€å’Œè¿›ç¨‹</li>
<li>åˆå§‹åŒ–å®Œæ¯•ï¼Œä½œä¸šè°ƒåº¦å™¨è·å–è¾“å…¥åˆ†ç‰‡ä¿¡æ¯ï¼Œ<strong>æ¯ä¸ªåˆ†ç‰‡åˆ›å»ºä¸€ä¸ªmapä»»åŠ¡</strong>ï¼›</li>
<li>å¼€å§‹åˆ†é…ä»»åŠ¡ï¼ŒtaskTrackeré€šè¿‡å¿ƒè·³åŒ…ğŸ’—ï¼ˆ5sä¸ºé—´éš”ï¼‰å‘JobTrackerå‘é€è‡ªå·±çš„çŠ¶æ€ï¼Œä¸¤è€…é€šè¿‡å¿ƒè·³åŒ…é€šä¿¡ï¼›</li>
<li>å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚å½“jobtrackerè·å¾—äº†æœ€åä¸€ä¸ªå®ŒæˆæŒ‡å®šä»»åŠ¡çš„ tasktrackeræ“ä½œæˆåŠŸçš„é€šçŸ¥æ—¶å€™ï¼Œjobtrackerä¼šæŠŠæ•´ä¸ªjobçŠ¶æ€ç½®ä¸ºæˆåŠŸã€‚</li>
</ol>
<h3 id="MapReduceçš„è¿è¡Œæœºåˆ¶"><a href="#MapReduceçš„è¿è¡Œæœºåˆ¶" class="headerlink" title="MapReduceçš„è¿è¡Œæœºåˆ¶"></a>MapReduceçš„è¿è¡Œæœºåˆ¶</h3><p><img src="/2017/08/14/Hadoop-MapReduce/mapreduceArch.tiff" alt=""><br>â€‹    åœ¨Hadoopä¸­ï¼Œä¸€ä¸ªMapReduceä½œä¸šä¼šæŠŠè¾“å…¥çš„æ•°æ®é›†åˆ‡åˆ†ä¸º<strong>è‹¥å¹²ç‹¬ç«‹çš„æ•°æ®å—</strong>ï¼Œç”±Mapä»»åŠ¡ä»¥<strong>å®Œå…¨å¹¶è¡Œ</strong>çš„æ–¹å¼å¤„ç†ï¼›<br>â€‹    æ¡†æ¶ä¼š<strong>å¯¹Mapçš„è¾“å‡ºå…ˆè¿›è¡Œæ’åºï¼Œ</strong>ç„¶åæŠŠç»“æœè¾“å…¥ç»™Reduceä»»åŠ¡ï¼›<br>ä½œä¸šçš„è¾“å…¥å’Œè¾“å‡ºéƒ½ä¼š<strong>è¢«å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­</strong>ï¼Œæ•´ä¸ªæ¡†æ¶è´Ÿè´£ä»»åŠ¡çš„è°ƒåº¦å’Œç›‘æ§ï¼Œä»¥åŠé‡æ–°æ‰§è¡Œå·²ç»å…³é—­çš„ä»»åŠ¡ï¼›<br>â€‹    MapReduceæ¡†æ¶å’Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ˜¯è¿è¡Œåœ¨<strong>ä¸€ç»„ç›¸åŒçš„èŠ‚ç‚¹</strong>ï¼Œ è®¡ç®—èŠ‚ç‚¹å’Œå­˜å‚¨èŠ‚ç‚¹éƒ½æ˜¯åœ¨ä¸€èµ·çš„ï¼›</p>
<h3 id="MapReduceçš„è¾“å…¥è¾“å‡º"><a href="#MapReduceçš„è¾“å…¥è¾“å‡º" class="headerlink" title="MapReduceçš„è¾“å…¥è¾“å‡º"></a>MapReduceçš„è¾“å…¥è¾“å‡º</h3><p>â€‹    åœ¨æ•´ä¸ªMapReduceä½œä¸šä¸­ï¼Œæ¶‰åŠåˆ°<strong>ä¸‰ç»„é”®å€¼å¯¹</strong>ã€‚</p>
<p><img src="/2017/08/14/Hadoop-MapReduce/keysAndValues.tiff" alt=""><br>â€‹    <k1ï¼Œv1>ï¼šåˆå§‹è¾“å…¥ï¼Œä½œä¸ºmapçš„è¾“å…¥ï¼›<br>â€‹    <k2ï¼Œv2>ï¼šmapçš„è¾“å‡ºï¼Œåœ¨ç»è¿‡shuffleï¼ˆæ’åºç­‰æ“ä½œï¼‰åï¼Œä½œä¸ºreduceçš„è¾“å…¥ï¼›<br>â€‹    <k3ï¼Œv3>ï¼šreduceçš„è¾“å‡ºã€‚</k3ï¼Œv3></k2ï¼Œv2></k1ï¼Œv1></p>
<h3 id="MapReduceçš„å·¥ä½œæµç¨‹"><a href="#MapReduceçš„å·¥ä½œæµç¨‹" class="headerlink" title="MapReduceçš„å·¥ä½œæµç¨‹"></a>MapReduceçš„å·¥ä½œæµç¨‹</h3><p>â€‹    MapReduceçš„å·¥ä½œæµç¨‹æ¶‰åŠåˆ°5ä¸ªå°æµç¨‹ï¼šinputï¼Œsplittingï¼Œ<strong>mapping</strong>ï¼Œshufflingï¼Œ<strong>reducing</strong>ï¼Œfinal resultã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2017/08/14/Hadoop-MapReduce/MRProcess.tiff" alt=""><br>â€‹    æ•™ç¨‹å°†å…¶é‡æ–°åˆ’åˆ†ä¸º<strong>5ä¸ªé˜¶æ®µ</strong>ã€‚è¾“å…¥åˆ†ç‰‡(input split)ã€ mapé˜¶æ®µã€ combineré˜¶æ®µã€ shuffleé˜¶æ®µå’Œ reduceé˜¶æ®µã€‚</p>
<h4 id="è¾“å…¥åˆ†ç‰‡-input-split"><a href="#è¾“å…¥åˆ†ç‰‡-input-split" class="headerlink" title="è¾“å…¥åˆ†ç‰‡(input split):"></a>è¾“å…¥åˆ†ç‰‡(input split):</h4><p>â€‹    åœ¨è¿›è¡Œmapè®¡ç®—ä¹‹å‰ï¼Œmapreduceä¼šæ ¹ æ®è¾“å…¥æ–‡ä»¶è®¡ç®—è¾“å…¥åˆ†ç‰‡(input split)ï¼Œæ¯ä¸ªè¾“å…¥åˆ†ç‰‡(input split)é’ˆå¯¹ä¸€ä¸ªmapä»»åŠ¡ï¼›<br>â€‹    è¾“å…¥åˆ†ç‰‡(input split)å­˜å‚¨çš„å¹¶éæ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯ä¸€ä¸ªåˆ†ç‰‡é•¿åº¦å’Œ ä¸€ä¸ªè®°å½•æ•°æ®çš„ä½ç½®çš„æ•°ç»„ï¼Œè¾“å…¥åˆ†ç‰‡(input split)å¾€å¾€å’Œhdfs çš„block(å—)å…³ç³»å¾ˆå¯†åˆ‡</p>
<blockquote>
<p>å‡å¦‚æˆ‘ä»¬è®¾å®šhdfsçš„å—çš„å¤§å°æ˜¯64mbï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¤§å°åˆ†åˆ« æ˜¯3mbã€65mbå’Œ127mbï¼Œé‚£ä¹ˆmapreduceä¼šæŠŠ<strong>3mbæ–‡ä»¶åˆ†ä¸ºä¸€ä¸ªè¾“å…¥åˆ†ç‰‡ï¼ˆ3mb &lt; 64mbï¼‰</strong> (input split)ï¼Œ<strong>65mbåˆ™æ˜¯ä¸¤ä¸ª( 128mb &gt; 65mb &gt; 64mb)</strong>è¾“å…¥åˆ†ç‰‡(input split)ï¼›è€Œ<strong>127mbä¹Ÿæ˜¯ä¸¤ä¸ªè¾“å…¥åˆ†ç‰‡ï¼ˆ128mb &gt; 127mb &gt; 64mbï¼‰</strong>(input split)ï¼›<br>å³æˆ‘ä»¬å¦‚æœåœ¨mapè®¡ç®—å‰åšè¾“å…¥åˆ†ç‰‡è°ƒæ•´ï¼Œä¾‹å¦‚åˆå¹¶å°æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰5ä¸ª mapä»»åŠ¡å°†æ‰§è¡Œï¼Œè€Œä¸”æ¯ä¸ªmapæ‰§è¡Œçš„æ•°æ®å¤§å°ä¸å‡ï¼Œè¿™ä¸ªä¹Ÿæ˜¯mapreduce ä¼˜åŒ–è®¡ç®—çš„ä¸€ä¸ªå…³é”®ç‚¹ã€‚  </p>
</blockquote>
<h4 id="mapé˜¶æ®µ"><a href="#mapé˜¶æ®µ" class="headerlink" title="mapé˜¶æ®µ"></a>mapé˜¶æ®µ</h4><p>â€‹    ç¨‹åºå‘˜ç¼–å†™çš„mapå‡½æ•°ï¼›</p>
<h4 id="combineé˜¶æ®µ"><a href="#combineé˜¶æ®µ" class="headerlink" title="combineé˜¶æ®µ"></a>combineé˜¶æ®µ</h4><p>â€‹    Combineré˜¶æ®µæ˜¯ç¨‹åºå‘˜å¯ä»¥é€‰æ‹©çš„ï¼Œ<strong>combinerå…¶å®ä¹Ÿæ˜¯ä¸€ç§reduceæ“ä½œ</strong>ï¼Œå› æ­¤æˆ‘ä»¬çœ‹è§WordCountç±»é‡Œæ˜¯ç”¨reduceè¿›è¡ŒåŠ è½½çš„ã€‚<br>â€‹    Combineræ˜¯ä¸€ä¸ª<strong>æœ¬åœ°åŒ–çš„reduceæ“ä½œ</strong>ï¼Œå®ƒæ˜¯mapè¿ç®—çš„åç»­æ“ä½œï¼Œä¸»è¦æ˜¯åœ¨mapè®¡ç®—å‡ºä¸­é—´æ–‡ä»¶å‰åšä¸€ä¸ª<strong>ç®€å•çš„åˆå¹¶é‡å¤keyå€¼çš„æ“ä½œ</strong>ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼šæˆ‘ä»¬å¯¹æ–‡ä»¶é‡Œçš„å•è¯é¢‘ç‡åšç»Ÿè®¡ï¼Œmapè®¡ç®—æ—¶å€™å¦‚æœç¢°åˆ°ä¸€ä¸ªhadoopçš„å•è¯å°±ä¼šè®°å½•ä¸º1ï¼Œä½†æ˜¯è¿™ç¯‡æ–‡ç« é‡Œhadoopå¯èƒ½ä¼šå‡ºç°nå¤šæ¬¡ï¼Œé‚£ä¹ˆmapè¾“å‡º æ–‡ä»¶å†—ä½™å°±ä¼šå¾ˆå¤šï¼Œå› æ­¤åœ¨reduceè®¡ç®—å‰å¯¹ç›¸åŒçš„keyåšä¸€ä¸ªåˆå¹¶æ“ä½œï¼Œ é‚£ä¹ˆæ–‡ä»¶ä¼šå˜å°ï¼Œè¿™æ ·å°±æé«˜äº†å®½å¸¦çš„ä¼ è¾“æ•ˆç‡ï¼Œæ¯•ç«Ÿhadoopè®¡ç®—åŠ›å®½å¸¦èµ„æºå¾€å¾€æ˜¯è®¡ç®—çš„ç“¶é¢ˆä¹Ÿæ˜¯æœ€ä¸ºå®è´µçš„èµ„æºï¼Œä½†æ˜¯combineræ“ä½œæ˜¯æœ‰ é£é™©çš„ï¼Œä½¿ç”¨å®ƒçš„åŸåˆ™æ˜¯<strong>combinerçš„è¾“å…¥ä¸ä¼šå½±å“åˆ°reduceè®¡ç®—çš„æœ€ç»ˆè¾“å…¥</strong>ï¼Œ<br>â€‹    ä¾‹å¦‚:å¦‚æœè®¡ç®—åªæ˜¯æ±‚æ€»æ•°ï¼Œæœ€å¤§å€¼ï¼Œæœ€å°å€¼å¯ä»¥ä½¿ç”¨combinerï¼Œä½†æ˜¯åšå¹³ å‡å€¼è®¡ç®—ä½¿ç”¨combinerçš„è¯ï¼Œæœ€ç»ˆçš„reduceè®¡ç®—ç»“æœå°±ä¼šå‡ºé”™ã€‚  </p>
</blockquote>
<h4 id="shuffleé˜¶æ®µ"><a href="#shuffleé˜¶æ®µ" class="headerlink" title="shuffleé˜¶æ®µ"></a>shuffleé˜¶æ®µ</h4><p>â€‹    å°†mapçš„è¾“å‡ºä½œä¸ºreduceçš„è¾“å…¥çš„è¿‡ç¨‹ã€‚</p>
<h4 id="reduceé˜¶æ®µ"><a href="#reduceé˜¶æ®µ" class="headerlink" title="reduceé˜¶æ®µ"></a>reduceé˜¶æ®µ</h4><p>â€‹    å’Œmapå‡½æ•°ä¸€æ ·ä¹Ÿæ˜¯ç¨‹åºå‘˜ç¼–å†™çš„,æœ€ç»ˆç»“æœæ˜¯å­˜å‚¨åœ¨ hdfsä¸Šçš„ã€‚</p>
<h2 id="çç¢"><a href="#çç¢" class="headerlink" title="çç¢"></a>çç¢</h2><blockquote>
<p>æ¯ä¸€ä¸ªç‰‡éƒ½ä¼šå¼€ä¸€ä¸ªmapperï¼Œæœ€ç»ˆå°†æ‰€æœ‰åˆ†ç‰‡è¿›è¡Œèšåˆ<br>æ‰€æœ‰çš„è¿™äº›è¿‡ç¨‹éƒ½æ˜¯é€šè¿‡jobtrackerè¿›è¡Œè°ƒåº¦çš„ã€‚<br>æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ˆclassï¼‰ï¼Œæ¯ä¸ªè¿›ç¨‹å¯åŠ¨æ— æ•°ä¸ªmapperï¼ˆçº¿ç¨‹ï¼‰<br>æœ‰å¤šå°‘ä¸ªkeyï¼Œå°±æœ‰å¤šå°‘ä¸ªreducerã€‚<br>åˆ†å—ï¼ä¸åŒå—å†…çš„æ•°æ®æ˜¯ä¸ç›¸åŒçš„  </p>
</blockquote>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/14/Hadoop-MapReduce/" data-id="cj6xjfeyo0006tsjo3arm4c0s" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MapReduce/">MapReduce</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-0811JavaHadoop" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/11/0811JavaHadoop/">ä½¿ç”¨Javaå¯¹HDFSè¿›è¡Œæ–‡ä»¶æ“ä½œ</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/11/0811JavaHadoop/" class="article-date"><time datetime="2017-08-11T11:38:25.000Z" itemprop="datePublished">2017-08-11</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¸»è¦çš„API"><a href="#ä¸»è¦çš„API" class="headerlink" title="ä¸»è¦çš„API"></a>ä¸»è¦çš„API</h2><pre><code>åœ¨Javaä¸­ï¼Œæ¶‰åŠåˆ°HDFSæ–‡ä»¶æ“ä½œçš„APIä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š
</code></pre><ol>
<li>FileSystem</li>
<li>FSDataOutputStream</li>
<li>FSDataInputStream</li>
<li>Path</li>
<li>Configuration </li>
<li><p>IOUtils</p>
<h3 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h3><p>FileSytemçš„å…¨é™å®šåä¸º<code>org.apache.hadoop.fs.FileSystem</code>ã€‚<br><code>org.apache.hadoop.fs.FileSystem</code>æ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­<strong>è®¿é—®å’Œç®¡ç†HDFSä¸­çš„æ–‡ä»¶/ç›®å½•çš„é€šç”¨ç±»</strong>ã€‚<br>æ–‡ä»¶å†…å®¹ä»¥å¤šä¸ªå¤§å°ºå¯¸å—ï¼ˆ64Mï¼‰çš„å½¢å¼å­˜å‚¨åœ¨datanodeä¸­ï¼Œnamenodeä¸­è®°å½•äº†è¿™äº›å—çš„ä¿¡æ¯å’Œæ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚<br>FileSystemå¯ä»¥è¯»æˆ–è€…<strong>æŒ‰å—çš„é¡ºåºæµå¼</strong>çš„è®¿é—®ã€‚<br>FileSystemé¦–å…ˆä»NameNodeä¸­å¾—åˆ°å—çš„ä¿¡æ¯ï¼Œç„¶å<strong>ä¸€ä¸ªæ¥ä¸€ä¸ª</strong>çš„è¯»ã€‚ ~å®ƒæ‰“å¼€ç¬¬ä¸€ä¸ªå—ï¼Œå®ƒå°†è¯»å®Œå…³é—­åæ‰è®¿é—®ä¸‹ä¸€å—~ ã€‚<br>HDFSçš„å¤åˆ¶å—å¸¦æ¥äº†æ›´é«˜çš„å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚å¦‚æœclientæ˜¯æ•°æ®èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªï¼Œå®ƒå°†å…ˆè®¿é—®æœ¬åœ°ï¼Œå¦‚æœå¤±è´¥çš„è¯ï¼Œå®ƒæ‰ä¼šåˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹å»è®¿é—®ã€‚</p>
<p><code>FileSystem</code>ä½¿ç”¨<code>FSDataOutputStream</code> åŠ<code>FSDataInputStream</code>æ¥è¯»å†™æµçš„å†…å®¹ã€‚Hadoopæä¾›äº†å¤šç§FileSystemçš„å®ç°ï¼š</p>
</li>
</ol>
<ul>
<li>DistributedFileSystemï¼ˆDFSï¼‰ï¼šåœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ï¼Œè®¿é—®HDFSæ–‡ä»¶</li>
<li>LocalFileSystem:åœ¨æœ¬åœ°ç³»ç»Ÿä¸­è®¿é—®HDFSæ–‡ä»¶</li>
<li>FTPFileSystemï¼šè®¿é—®HDFSæ–‡ä»¶çš„FTPå®¢æˆ·ç«¯</li>
<li>WebHdfsFileSystemï¼šé€šè¿‡webæ¥å£è®¿é—®HDFSæ–‡ä»¶ã€‚</li>
</ul>
<h4 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h4><p>FileSystem çš„å¸¸ç”¨æ“ä½œå’Œç›¸å…³æ–¹æ³•ï¼š</p>
<ol>
<li>åˆ›å»ºæ–‡ä»¶<ul>
<li><code>booleancreateNewFile(Path f )</code><ul>
<li><strong>ä¸ä¼šè¦†ç›–</strong>å·²æœ‰æ–‡ä»¶</li>
<li>åˆ›å»ºæˆåŠŸè¿”å›true,å¤±è´¥è¿”å›false<br>â€¢ <code>FSDataOutputStreamcreate(Path f)</code><br>â€¢ <strong>è¦†ç›–</strong>å·²æœ‰æ–‡ä»¶<br>â€¢ åˆ›å»ºæ–‡ä»¶å¹¶è¿”å›è¾“å‡ºæµ<br>â€¢ <code>FSDataOutputStreamcreate(Path f,booleanoverwrite)</code><br>â€¢ åˆ›å»ºæ–‡ä»¶å¹¶è¿”å›è¾“å‡ºæµ<br>â€¢ <code>FSDataOutputStreamcreate(Path f,boolean overwrite,int buffer)</code><br>â€¢ <code>FSDataOutputStreamcreate(Path f,boolean overwrite,int buffer,short replication,long blockSize)</code></li>
</ul>
</li>
</ul>
</li>
<li>æ‰“å¼€æ–‡ä»¶<ul>
<li><code>FSDataInputStreamopen(Pathf)</code></li>
<li><code>FSDataInputStreamopen(Pathf,intbufferSize)</code><ul>
<li>è¿”å›è¾“å…¥æµ</li>
<li>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸</li>
<li>ä¸æŒ‡å®šbufferSizeæ—¶,ä¼šä»Configurationä¸­è¯»å– io.file.buffer.size,é»˜è®¤ä¸º4096å­—èŠ‚</li>
</ul>
</li>
</ul>
</li>
<li>æ–‡ä»¶è¿½åŠ <br>â€¢ <code>FSDataOutputStream append(Path f)</code><br>â€¢ <code>FSDataOutputStream append(Path f, int bufferSize)</code><br>   â€¢ å—ä¸è¶³64Mæ—¶,ä¼šè¡¥è¶³åˆ°64M<br>   â€¢ å—è¾¾åˆ°64Mä¹‹å‰,è¯¥å—ä¸å¯è§,lsçœ‹ä¸åˆ°è¯¥å—æ–°å¢çš„å¤§å°,ä¹Ÿæ—  æ³•è¯»å–<br>   â€¢ ä¸èƒ½åŒæ—¶å¤šä¸ªwriterè¿½åŠ åŒä¸€ä¸ªæ–‡ä»¶</li>
<li>ä»æœ¬åœ°æ‹·è´æ–‡ä»¶åˆ°HDFS<ul>
<li><code>void copyFromLocalFile (Path src, Path dst)</code></li>
<li><code>void moveFromLocalFile (Path src, Path dst)</code></li>
</ul>
</li>
<li>ä»HDFSæ‹·è´æ–‡ä»¶åˆ°æœ¬åœ°<ul>
<li><code>void copyToLocalFile(boolean delsrc,Path src,Path dst)</code></li>
<li><code>void moveToLocalFile (Path src, Path dst)</code></li>
</ul>
</li>
<li>åˆ›å»ºç›®å½•<ul>
<li>boolean mkdirs (Path f)<br>â€¢ boolean mkdirs (Path f, FsPermission permission)<br>â€¢ static boolean mkdirs (FileSystem fs, Path dir, FsPermission permission)<br>â€¢ æ”¯æŒå¤šçº§ç›®å½•åŒæ—¶åˆ›å»º (ç±»ä¼¼mkdir -p)<br>â€¢ é»˜è®¤æƒé™æ˜¯755<br>â€¢ æˆåŠŸè¿”å›true</li>
</ul>
</li>
<li>åˆ é™¤åŠé‡å‘½å<ul>
<li><code>boolean delete (Path f, boolean recursive)</code></li>
<li><code>boolean deleteOnExit (f)</code> å½“å…³é—­FileSystemæ—¶,æ‰ä¼šåˆ é™¤</li>
</ul>
</li>
<li>è·å–æ–‡ä»¶æˆ–ç›®å½•ä¿¡æ¯<ul>
<li>FileStatus[ ] listStatus (Path f, PathFilter filter)<br>â€¢ FileStatus[ ] listStatus (Path[ ] dir, PathFilter filter)<br>FileStatusä¿¡æ¯åŒ…æ‹¬:</li>
<li>ç»å¯¹è·¯å¾„</li>
<li>æ–‡ä»¶å¤§å°(å•ä½:å­—èŠ‚)</li>
<li>æ–‡ä»¶è®¿é—®æ—¶é—´</li>
<li>å—å¤§å°ã€å¤åˆ¶ä»½æ•°</li>
<li>æ–‡ä»¶æ‰€å±ç”¨æˆ·ã€ç»„ã€è®¿é—®æƒé™</li>
</ul>
</li>
<li>è®¾ç½®æ–‡ä»¶æˆ–ç›®å½•å±æ€§<ul>
<li>void setOwner (Path p, String username, String groupname)<ul>
<li>è®¾ç½®æ–‡ä»¶æˆ–ç›®å½•æ‰€å±ç”¨æˆ·åŠç»„</li>
<li>å‚æ•°pæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•</li>
<li>å‚æ•°username,è®¾ç½®æ­¤æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç”¨æˆ· â€“ åªè¿”å›åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–ç›®å½•ä¿¡æ¯<br>â€¢ void setPermission (Path p, FsPermission permission)<br>â€¢ è®¾ç½®æ–‡ä»¶æˆ–ç›®å½•æƒé™<br>â€¢ å‚æ•°pæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•<br>â€¢ å‚æ•°permission,æŒ‡å®šæƒé™,æƒé™åŒlinuxæƒé™é›·åŒ<br>â€¢ void setReplication (Path f, short replication)<br>â€¢ è®¾ç½®æ–‡ä»¶å¤åˆ¶ä»½æ•°<br>â€¢ å‚æ•°fæŒ‡å®šæ–‡ä»¶<br>â€¢ å‚æ•°replicationæŒ‡å®šå¤åˆ¶ä»½æ•°</li>
</ul>
</li>
</ul>
</li>
<li>è·å–æ–‡ä»¶æˆ–ç›®å½•ä¿¡æ¯<ul>
<li>void setTimes (Path f, long mtime, long atime)<br>è®¾ç½®æ–‡ä»¶çš„ä¿®æ”¹åŠè®¿é—®æ—¶é—´</li>
</ul>
</li>
</ol>
<h3 id="FSDataOutputStream"><a href="#FSDataOutputStream" class="headerlink" title="FSDataOutputStream"></a>FSDataOutputStream</h3><pre><code>FSDataOutputStreamçš„å…¨é™å®šåæ˜¯`org.apache.hadoop.fs.FSDataOutputStream`ã€‚
ä½¿ç”¨Javaå‘HDFS**å†™å…¥æ•°æ®**æ—¶éœ€è¦ç”¨åˆ°çš„æµã€‚
</code></pre><h3 id="FSDataInputStream"><a href="#FSDataInputStream" class="headerlink" title="FSDataInputStream"></a>FSDataInputStream</h3><pre><code>FSDataInputStreamçš„å…¨é™å®šåæ˜¯`org.apache.hadoop.fs. FSDataInputStream `ã€‚
ä½¿ç”¨Javaå‘HDFS**è¯»å–æ•°æ®**æ—¶éœ€è¦ç”¨åˆ°çš„æµã€‚
</code></pre><h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><pre><code>Pathçš„å…¨é™å®šåä¸º`org.apache.hadoop.fs.Path`
ç”¨æ¥å°è£…HDFSçš„è·¯å¾„ã€‚
</code></pre><h4 id="å¸¸ç”¨çš„æ–¹æ³•"><a href="#å¸¸ç”¨çš„æ–¹æ³•" class="headerlink" title="å¸¸ç”¨çš„æ–¹æ³•"></a>å¸¸ç”¨çš„æ–¹æ³•</h4><p>Pathçš„å¸¸æœ‰æ–¹æ³•æœ‰ï¼š</p>
<ol>
<li><code>int depth()</code>ï¼šè¿”å›è·¯å¾„çš„æ·±åº¦</li>
<li><code>String getName()</code>ï¼š è¿”å›è·¯å¾„ä¸Šæœ€åçš„èµ„æºåç§°</li>
<li><code>Path getParent()</code>ï¼šè¿”å›çˆ¶ç›®å½•ï¼Œå¦‚æœå·²æ˜¯æ ¹ç›®å½•åˆ™è¿”å›null</li>
<li><code>Path suffix(String suffix)</code>ï¼šå‚æ•°suffixç»™Pathå¢åŠ åç¼€ï¼Œè¿”å›åŠ å®Œåç¼€çš„Pathå®ä¾‹ï¼›</li>
<li><code>getFileSystem (Configuration conf)</code>ï¼šè¿”å›è¯¥Pathæ‰€å±çš„æ–‡ä»¶ç³»ç»Ÿå®ä¾‹</li>
</ol>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><pre><code>Configurationå…¨é™å®šåä¸º
</code></pre><p><code>org.apache.hadoop.conf. Configuration</code>ã€‚<br>â€‹<br>Configurationå¯¹é…ç½®æ–‡ä»¶çš„è¯»å–é¡ºåºï¼šå…ˆåŠ è½½ç¼ºçœé…ç½®æ–‡ä»¶ï¼Œå†åŠ è½½ç”¨æˆ·å®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼›ä¸”å¯¹äºæ¯ä¸€ä¸ªæ–‡ä»¶åªåŠ è½½ä¸€æ¬¡ï¼šç¬¬ä¸€ä¸ªåœ¨classpathå‡ºç°çš„ï¼ˆè¿™ä¸ªå’ŒLinuxç³»ç»Ÿä¸Šåœ¨åŒ¹é…å‘½ä»¤æ—¶å€™çš„é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼‰</p>
<p><em>classpathçš„ç›®å½•é¡ºåº:</em></p>
<ol>
<li>$HADOOP_CONF_DIR</li>
<li>$JAVA_HOME/lib/tools.jar å¦‚æœ$HADOOP_HOMEç›®å½•ä¸‹æœ‰buildç›®å½•ï¼Œåˆ™æ·»åŠ buildä¸‹å„å­ç›®å½•</li>
<li>$HADOOP_HOME/hadoop-core-*.jar</li>
<li>$HADOOP_HOME/lib/*.jar</li>
<li>ç”¨æˆ·åœ¨hadoop-env.shä¸­å®šä¹‰çš„$HADOOP_CLASS_PATH</li>
<li>å½“å‰ä½œä¸ºhadoop jar â€¦å‚æ•°æäº¤çš„JARåŒ…</li>
</ol>
<h4 id="å¸¸ç”¨æ–¹æ³•-1"><a href="#å¸¸ç”¨æ–¹æ³•-1" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h4><pre><code>Configurationçš„å¸¸ç”¨æ–¹æ³•æœ‰:
</code></pre><ol>
<li>static void addDefaultResource(String name)</li>
<li>void addResource(InputStream in)</li>
<li>void addResource (Path file)  æœ¬åœ°æ–‡ä»¶</li>
<li>void addResource(String name)  classpathä¸­çš„æ–‡ä»¶</li>
<li>void addResource (URL url)void set(String name, String value)</li>
<li>void setBoolean(String name, boolean value)</li>
<li>void setInt(String name, String value)</li>
<li>void setLong(String name, long value)</li>
<li>void setFloat(String name, float value)</li>
<li>void setIfUnset(String name, String value)</li>
<li>void setBooleanIfUnset(String name, boolean value)</li>
<li>String get(String name)</li>
<li>boolean getBoolean(String name, boolean defaultValue)</li>
</ol>
<h3 id="IOUtils"><a href="#IOUtils" class="headerlink" title="IOUtils"></a>IOUtils</h3><pre><code>IOUtilsçš„å…¨é™å®šåæ˜¯`org.apache.hadoop.fs. IOUtils `ã€‚
IOUtilsæ˜¯ä¸€ä¸ªI/Oå¸®åŠ©ç±»,æä¾›çš„éƒ½æ˜¯é™æ€æ–¹æ³•,ä¸éœ€è¦å®ä¾‹åŒ–ã€‚
</code></pre><h4 id="å¸¸ç”¨æ–¹æ³•-2"><a href="#å¸¸ç”¨æ–¹æ³•-2" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h4><p>IOUtilsçš„å¸¸ç”¨æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>public static void copyBytes (InputStream in , outputStream out,<br>Configuration conf)<br>â€¢ public static void copyBytes (InputStream in , outputStream out, Configuration conf, boolean close)</li>
</ul>
<h2 id="å¼€å‘åŸºæœ¬æ­¥éª¤"><a href="#å¼€å‘åŸºæœ¬æ­¥éª¤" class="headerlink" title="å¼€å‘åŸºæœ¬æ­¥éª¤"></a>å¼€å‘åŸºæœ¬æ­¥éª¤</h2><p>ä½¿ç”¨Javaåœ¨HDFSä¸Šçš„åŸºæœ¬å¼€å‘æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®ä¾‹åŒ–<code>Configuration</code></li>
<li>å®ä¾‹åŒ–<code>FileSystem</code><ol>
<li>è·å–ç›¸å…³Streamè¿›è¡Œæ–‡ä»¶ï¼ç›®å½•æ“ä½œ</li>
</ol>
</li>
</ol>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/11/0811JavaHadoop/" data-id="cj6xjfeyk0005tsjonvicuwcu" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HDFS/">HDFS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-0811HadoopIO" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/11/0811HadoopIO/">Hadoop IOæ“ä½œ</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/11/0811HadoopIO/" class="article-date"><time datetime="2017-08-11T11:31:25.000Z" itemprop="datePublished">2017-08-11</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Hadoopçš„IOæ“ä½œä¸­æ¶‰åŠåˆ°å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¿æŒæ•°æ®å®Œæ•´æ€§</li>
<li>æ•°æ®å‹ç¼©</li>
<li>åºåˆ—åŒ–</li>
<li>å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„</li>
</ol>
<h2 id="æ•°æ®å®Œæ•´æ€§"><a href="#æ•°æ®å®Œæ•´æ€§" class="headerlink" title="æ•°æ®å®Œæ•´æ€§"></a>æ•°æ®å®Œæ•´æ€§</h2><p>â€‹    é’ˆå¯¹æ•°æ®åœ¨å­˜å‚¨è¿‡ç¨‹æŸåå’Œä¸¢å¤±çš„é—®é¢˜ï¼ŒHaddopé‡‡å–äº†<strong>æ•°æ®æ ¡éªŒ</strong>å’Œ<strong>åå°è¿›ç¨‹æ£€æµ‹æ•°æ®å—</strong>çš„æ–¹æ³•ã€‚<br>â€‹    æ•°æ®æ ¡éªŒé‡‡ç”¨çš„æ˜¯<strong>å¾ªç¯å†—ä½™æ ¡éªŒCRC-32</strong>ã€‚</p>
<h3 id="éªŒè¯æ—¶æœº"><a href="#éªŒè¯æ—¶æœº" class="headerlink" title="éªŒè¯æ—¶æœº"></a>éªŒè¯æ—¶æœº</h3><ol>
<li>æ•°æ®èŠ‚ç‚¹è´Ÿè´£åœ¨å­˜å‚¨æ•°æ®åŠå…¶æ ¡éªŒå’Œå‰éªŒè¯å®ƒä»¬æ”¶åˆ°çš„æ•°æ®ï¼ˆå‘ç”Ÿäºæ•°æ®å—å‰¯æœ¬ä¼ è¾“çš„æ—¶å€™ï¼‰ ï¼ˆå­˜å‚¨æ—¶ï¼‰ï¼›</li>
<li>å®¢æˆ·ç«¯è¯»å–æ•°æ®èŠ‚ç‚¹ä¸Šçš„æ•°æ®æ—¶å€™ï¼Œä¼šéªŒè¯æ ¡éªŒå’Œï¼ˆè¯»å–æ—¶ï¼‰ï¼›</li>
<li>æ¯ä¸ªæ•°æ®èŠ‚ç‚¹æœ‰ä¸€ä¸ªåå°è¿›ç¨‹å®šæœŸéªŒè¯å­˜åœ¨è¯¥èŠ‚ç‚¹å±±çš„æ‰€æœ‰æ•°æ®å—ï¼ˆå®šæ—¶ï¼‰ï¼›</li>
</ol>
<p>å…³äºéªŒè¯ï¼Œæ¶‰åŠåˆ°ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªæ˜¯<code>FileSystem</code>ï¼Œä¸€ä¸ªæ˜¯<code>CheckSumFileSystem</code>ã€‚</p>
<h2 id="åŸºäºæ–‡ä»¶çš„æ•°æ®ç»“æ„"><a href="#åŸºäºæ–‡ä»¶çš„æ•°æ®ç»“æ„" class="headerlink" title="åŸºäºæ–‡ä»¶çš„æ•°æ®ç»“æ„"></a>åŸºäºæ–‡ä»¶çš„æ•°æ®ç»“æ„</h2><p>HDFSå’ŒMRä¸»è¦é’ˆå¯¹å¤§æ•°æ®æ–‡ä»¶æ¥è®¾è®¡ï¼Œåœ¨<em>å°æ–‡ä»¶å¤„ç†ä¸Šæ•ˆç‡ä½</em>ã€‚è§£å†³æ–¹æ³•æ˜¯é€‰æ‹©ä¸€ä¸ªå®¹å™¨ï¼Œå°†è¿™äº›å°æ–‡ä»¶åŒ…è£…èµ·æ¥ï¼Œ å°†æ•´ä¸ªæ–‡ä»¶ä½œä¸ºä¸€æ¡è®°å½•ï¼Œå¯ä»¥è·å–æ›´é«˜æ•ˆç‡çš„å‚¨å­˜å’Œå¤„ç†ï¼Œ é¿å…å¤šæ¬¡æ‰“å¼€å…³é—­æµè€—è´¹è®¡ç®—èµ„æº.hdfsæä¾›äº†ä¸¤ç§ç±»å‹çš„å®¹å™¨ <strong>SequenceFile</strong>å’Œ<strong>MapFile</strong>ã€‚<br><em>ä¸€è¨€è”½ä¹‹ï¼Œè¿™äº›æ–‡ä»¶ç»“æ„ç”¨æ¥è§£å†³HDFSå­˜å‚¨å°æ–‡ä»¶çš„ç—›ç‚¹ã€‚</em></p>
<h3 id="SequenceFile"><a href="#SequenceFile" class="headerlink" title="SequenceFile"></a>SequenceFile</h3><p>â€‹    SequenceFileæ˜¯Hadoopå¯¹äºŒè¿›åˆ¶é”®ï¼å€¼å¯¹æŒä¹…åŒ–çš„æ•°æ®ç»“æ„ã€‚<br>â€‹    Sequenceçš„å†…éƒ¨ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/2017/08/11/0811HadoopIO/The-internal-structure-of-a-sequence-file-with-no-compression-and-record-compression.png" alt=""></p>
<p>â€‹    Sequence fileç”±ä¸€ç³»åˆ—çš„äºŒè¿›åˆ¶key/valueç»„æˆï¼Œå¦‚æœkeyä¸ºå°æ–‡ä»¶åï¼Œvalueä¸ºæ–‡ä»¶å†…å®¹ï¼Œåˆ™å¯ä»¥å°†å¤§æ‰¹å°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶ã€‚æ–‡ä»¶ä¸­æ¯æ¡è®°å½•æ˜¯å¯åºåˆ—åŒ–ï¼Œå¯æŒä¹…åŒ–çš„é”®å€¼å¯¹ï¼Œæç›¸åº”çš„<strong>è¯»å†™å™¨</strong>å’Œ<strong>æ’åºå™¨</strong>ï¼Œå†™æ“ä½œæ ¹æ®å‹ç¼©çš„ç±»å‹åˆ†ä¸º3ç§ï¼š</p>
<ul>
<li><p>Write æ— å‹ç¼©å†™æ•°æ®ï¼Œ</p>
</li>
<li><p>RecordCompressWriterè®°å½•çº§å‹ç¼©æ–‡ä»¶ï¼Œåªå‹ç¼©å€¼</p>
</li>
<li><p>BlockCompressWriteå—çº§å‹ç¼©æ–‡ä»¶ï¼Œé”®å€¼é‡‡ç”¨ç‹¬ç«‹å‹ç¼©æ–¹å¼;</p>
<p>å…³äºå‹ç¼©çš„å¯¹è±¡ï¼Œvalueå¯ä»¥å‹ç¼©ï¼Œkeyä¸å¯ä»¥å‹ç¼©ã€‚</p>
<h4 id="å¯¹SequenceFileçš„æ“ä½œæ–¹æ³•ï¼š"><a href="#å¯¹SequenceFileçš„æ“ä½œæ–¹æ³•ï¼š" class="headerlink" title="å¯¹SequenceFileçš„æ“ä½œæ–¹æ³•ï¼š"></a>å¯¹SequenceFileçš„æ“ä½œæ–¹æ³•ï¼š</h4><p>â€‹    Hadoop-0.21.0ç‰ˆæœ¬å¼€å§‹ä¸­æä¾›äº†SequenceFileï¼ŒåŒ…æ‹¬Writerï¼ŒReaderå’ŒSequenceFileSorterç±»è¿›è¡Œå†™ï¼Œ è¯»å’Œæ’åºæ“ä½œã€‚</p>
</li>
</ul>
<p>â€‹    è¯¥æ–¹æ¡ˆå¯¹äºå°æ–‡ä»¶çš„å­˜å–éƒ½æ¯”è¾ƒè‡ªç”±ï¼Œä¸é™åˆ¶ç”¨æˆ·å’Œæ–‡ä»¶çš„å¤šå°‘ï¼Œ <strong>æ”¯æŒAppendè¿½åŠ å†™å…¥</strong>ï¼Œæ”¯æŒä¸‰çº§æ–‡æ¡£å‹ç¼©(ä¸å‹ç¼©ã€æ–‡ä»¶çº§ã€å—çº§åˆ«)ã€‚</p>
<h3 id="MapFile"><a href="#MapFile" class="headerlink" title="MapFile"></a>MapFile</h3><p>â€‹    MapFileæ˜¯<strong>ç»è¿‡æ’åº</strong>è¿‡åçš„<strong>å¸¦ç´¢å¼•</strong>çš„SequenceFileå¯ä»¥æ ¹æ®é”®è¿›è¡ŒæŸ¥æ‰¾ã€‚</p>
<p><img src="/2017/08/11/0811HadoopIO/mapFile.png" alt=""></p>
<p>â€‹    ä¸€ä¸ªMapFile ~å¯ä»¥é€šè¿‡SequenceFileçš„åœ°å€ï¼Œè¿›è¡Œåˆ†ç±»æŸ¥æ‰¾çš„æ ¼å¼~ ã€‚ä½¿ç”¨è¿™ä¸ªæ ¼ å¼çš„ä¼˜ç‚¹åœ¨äºï¼Œé¦–å…ˆä¼šå°†SequenceFileä¸­çš„åœ°å€éƒ½åŠ è½½å…¥å†…å­˜ï¼Œå¹¶ä¸”è¿›è¡Œäº†key å€¼æ’åºï¼Œä»è€Œæä¾›æ›´å¿«çš„æ•°æ®æŸ¥æ‰¾ã€‚<br>ä¸SequenceFileåªç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ä¸åŒï¼ŒMapFile<strong>ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤¹</strong>ã€‚ ç´¢å¼•æ¨¡å‹æŒ‰<strong>128ä¸ªé”®</strong>å»ºç«‹çš„ï¼Œå¯ä»¥é€šè¿‡<code>io.map.index.interval</code>æ¥ä¿®æ”¹ã€‚</p>
<p>â€‹    </p>
<h3 id="MapFileå’ŒSequenceFileçš„æ¯”è¾ƒ"><a href="#MapFileå’ŒSequenceFileçš„æ¯”è¾ƒ" class="headerlink" title="MapFileå’ŒSequenceFileçš„æ¯”è¾ƒ"></a>MapFileå’ŒSequenceFileçš„æ¯”è¾ƒ</h3><ol>
<li>SequenceFileæ–‡ä»¶æ˜¯ç”¨æ¥å­˜å‚¨key-valueæ•°æ®çš„ï¼Œä½†å®ƒå¹¶<strong>ä¸ä¿è¯è¿™äº›å­˜å‚¨çš„key-valueæ˜¯æœ‰åºçš„</strong>ï¼›MapFileæ–‡ä»¶åˆ™å¯ä»¥çœ‹åšæ˜¯å­˜å‚¨æœ‰åºkey-valueçš„ SequenceFileæ–‡ä»¶ã€‚</li>
<li>MapFileæ–‡ä»¶ä¿è¯key-valueçš„æœ‰åºï¼ˆåŸºäºkeyï¼‰æ˜¯é€šè¿‡ ~æ¯ä¸€æ¬¡å†™å…¥ key-valueæ—¶çš„æ£€æŸ¥æœºåˆ¶~ ï¼Œè¿™ç§æ£€æŸ¥æœºåˆ¶å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ ~ä¿è¯å½“å‰æ­£è¦å†™å…¥çš„key-valueä¸ä¸Šä¸€ä¸ªåˆšå†™å…¥çš„key-valueç¬¦åˆè®¾å®šçš„é¡ºåº~ ï¼›ä½†æ˜¯ï¼Œè¿™ç§æœ‰åºæ˜¯ç”±ç”¨æˆ·æ¥ä¿è¯çš„ï¼Œä¸€æ—¦å†™å…¥çš„key-valueä¸ç¬¦åˆkeyçš„éé€’å‡é¡ºåºï¼Œåˆ™ä¼šç›´æ¥æŠ¥é”™è€Œä¸æ˜¯è‡ªåŠ¨çš„å»å¯¹è¾“å…¥çš„key-valueæ’åºï¼›</li>
</ol>
<h2 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h2><p>â€‹    å¼•å…¥å‹ç¼©æ˜¯ä¸ºäº†<strong>å‡å°‘å‚¨å­˜æ–‡ä»¶æ‰€éœ€ç©ºé—´</strong>ï¼Œè¿˜å¯ä»¥<strong>é™ä½å…¶åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ—¶é—´</strong>ã€‚</p>
<p>â€‹    æ­¤å¤„ç®€å•åˆ—å‡ºHadoopä¸Šçš„å¸¸ç”¨çš„å‹ç¼©ï¼š<br><img src="/2017/08/11/0811HadoopIO/compressionTypes.tiff" alt=""></p>
<p><em>å…³äºåˆ‡åˆ†</em><br>â€‹    ä¸¾Bzip2ä¸ºä¾‹ï¼ŒBzip2æ”¯æŒåˆ‡åˆ†splitting.hdfsä¸Šæ–‡ä»¶1GBï¼Œå¦‚æŒ‰ç…§é»˜è®¤å—64MBï¼Œé‚£ä¹ˆè¿™ä¸ª æ–‡ä»¶è¢«åˆ†ä¸º16ä¸ªå—ï¼ˆ1024/64ï¼‰ã€‚å¦‚æœæŠŠè¿™ä¸ªå—æ”¾å…¥MRä»»åŠ¡ ï¼Œå°†æœ‰<strong>16ä¸ªmapä»»åŠ¡è¾“å…¥</strong>ã€‚ å¦‚æœç®—æ³•ä¸æ”¯æŒåˆ‡åˆ†ï¼Œåæœæ˜¯MRæŠŠè¿™ä¸ªæ–‡ä»¶ä½œä¸º<strong>ä¸€ä¸ªMapè¾“å…¥</strong>ã€‚è¿™æ ·ä»»åŠ¡å‡å°‘äº†ï¼Œé™ä½äº†æ•°æ®çš„æœ¬åœ°æ€§ã€‚<br>â€‹    </p>
<h3 id="Hadoopä¸­å®ç°å‹ç¼©çš„æ–¹æ³•"><a href="#Hadoopä¸­å®ç°å‹ç¼©çš„æ–¹æ³•" class="headerlink" title="Hadoopä¸­å®ç°å‹ç¼©çš„æ–¹æ³•"></a>Hadoopä¸­å®ç°å‹ç¼©çš„æ–¹æ³•</h3><p>â€‹    å¤§è‡´è¯´æ¥æœ‰ä¸¤ç§é€”å¾„ï¼šCodeCå’Œä½¿ç”¨æœ¬åœ°åº“ã€‚</p>
<h4 id="Codec"><a href="#Codec" class="headerlink" title="Codec"></a>Codec</h4><p>â€‹    Hadoopä¸­å‹ç¼©è§£å‹ç±»å®ç°<code>CompressionCodec</code>æ¥å£<code>createOutputStream</code>æ¥åˆ›å»ºä¸€ä¸ª<code>CompressionOutputStream</code>ï¼Œå°†å…¶å‹ç¼©æ ¼å¼å†™å…¥åº•å±‚çš„æµã€‚</p>
<h3 id="æœ¬åœ°åº“"><a href="#æœ¬åœ°åº“" class="headerlink" title="æœ¬åœ°åº“"></a>æœ¬åœ°åº“</h3><p>â€‹    Hadoopä½¿ç”¨javaå¼€å‘ï¼Œä½†æ˜¯æœ‰äº›éœ€æ±‚å’Œæ“ä½œå¹¶ä¸é€‚åˆjavaï¼Œæ‰€ä»¥å¼•å…¥äº†æœ¬åœ° åº“ nativeã€‚å¯ä»¥é«˜æ•ˆæ‰§è¡ŒæŸäº›æ“ä½œã€‚<br>å¦‚æœé¢‘ç¹ä½¿ç”¨åŸç”Ÿåº“åšå‹è§£å‹ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ codecpoolï¼Œé€šè¿‡CodecPoolçš„getCompressoræ–¹æ³•è·å¾—Compressorå¯¹è±¡ï¼Œ éœ€è¦ä¼ å…¥Codec ã€‚è¿™æ ·å¯ä»¥èŠ‚çœåˆ›å»ºCodecå¯¹è±¡å¼€é”€ ï¼Œå…è®¸åå¤ä½¿ç”¨ã€‚<br>â€‹<br>â€‹    ä¸åŒçš„å‹ç¼©æ–¹æ³•æ€§èƒ½ä¸Šå„ä¸ç›¸åŒï¼Œ<strong>æ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯æ¥é€‰æ‹©æœ€åˆé€‚çš„å‹ç¼©ç®—æ³•</strong>ã€‚</p>
<p>å„ä¸ªå‹ç¼©ç®—æ³•çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š    </p>
<ol>
<li>Gzip ä¼˜ç‚¹<strong>æ˜¯å‹ç¼©ç‡é«˜ï¼Œé€Ÿåº¦å¿«</strong>ã€‚Hadoopæ”¯æŒä¸ç›´æ¥å¤„ç†æ–‡æœ¬ä¸€ æ ·ã€‚ç¼ºç‚¹ä¸æ”¯æŒsplitï¼Œå½“æ–‡ä»¶å‹ç¼©åœ¨128må†…ï¼Œéƒ½å¯ä»¥ç”¨gzipï¼ˆä¹Ÿå°±æ˜¯è¯´å­˜åœ¨äºä¸€ä¸ªæ•°æ®å—å†…ï¼‰ï¼›</li>
<li>Izo ä¼˜ç‚¹å‹ç¼©é€Ÿåº¦å¿«ï¼Œå…·æœ‰åˆç†çš„å‹ç¼©ç‡ï¼Œæ”¯æŒsplitï¼Œæ˜¯<strong>æœ€æµè¡Œçš„</strong>å‹ç¼©æ ¼å¼ã€‚æ”¯æŒnativeåº“ï¼›ç¼ºç‚¹æ˜¯æ¯”gzipå‹ç¼©ç‡ä½ï¼Œ<strong>hadoopæœ¬èº«ä¸æ”¯æŒ</strong>ï¼Œéœ€è¦å®‰è£…ï¼›åœ¨åº”ç”¨ä¸­å¯¹lzoæ ¼å¼æ–‡ä»¶éœ€è¦å¤„ç†å¦‚ æŒ‡å®š inputformatä¸ºlzoæ ¼å¼</li>
<li>Snappyå‹ç¼© é«˜é€Ÿå‹ç¼©ç‡åˆç†æ”¯æŒæœ¬åœ°åº“ã€‚ä¸æ”¯æŒsplitï¼Œ <strong>hadoopä¸æ”¯æŒ</strong>ï¼Œè¦å®‰è£…linuxæ²¡æœ‰å¯¹åº”å‘½ä»¤ï¼›å½“MRè¾“å‡ºæ•°æ®è¾ƒå¤§ï¼Œ ä½œä¸ºåˆ°reduceæ•°æ®å‹ç¼©æ ¼å¼</li>
<li>Bzip2 æ”¯æŒsplitï¼Œå¾ˆé«˜çš„å‹ç¼©ç‡ï¼Œæ¯”gzipé«˜ï¼Œ<strong>hadoopæ”¯æŒä½†ä¸æ”¯æŒnative</strong>ï¼Œlinuxè‡ªå¸¦å‘½ä»¤ä½¿ç”¨æ–¹ä¾¿ã€‚ç¼ºç‚¹å‹ç¼©è§£å‹é€Ÿåº¦æ…¢</li>
</ol>
<h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><h3 id="Hadoopå¼•å…¥åºåˆ—åŒ–çš„åŸå› "><a href="#Hadoopå¼•å…¥åºåˆ—åŒ–çš„åŸå› " class="headerlink" title="Hadoopå¼•å…¥åºåˆ—åŒ–çš„åŸå› "></a>Hadoopå¼•å…¥åºåˆ—åŒ–çš„åŸå› </h3><ol>
<li>Hadoopåœ¨<strong>é›†ç¾¤ä¹‹é—´é€šä¿¡æˆ–è€…RPCè°ƒç”¨æ—¶éœ€è¦åºåˆ—åŒ–</strong>ï¼Œè€Œä¸”è¦æ±‚åºåˆ—åŒ–è¦å¿«ï¼Œä¸”ä½“ç§¯è¦å°ï¼Œå ç”¨å¸¦å®½å°ï¼›</li>
<li><strong>Javaçš„åºåˆ—åŒ–æœºåˆ¶ä¸æ»¡è¶³Hadoopçš„éœ€æ±‚</strong>ï¼Œå ç”¨å¤§é‡è®¡ç®—å¼€é”€ï¼Œä¸”åºåˆ—åŒ–ç»“æœä½“ç§¯è¿‡å¤§;ï¼›å®ƒçš„å¼•ç”¨æœºåˆ¶ä¹Ÿå¯¼è‡´å¤§æ–‡ä»¶ä¸èƒ½è¢«åˆ‡åˆ†ï¼Œæµªè´¹ç©ºé—´ï¼›æ­¤å¤–ï¼Œå¾ˆéš¾å¯¹å…¶ä»–è¯­è¨€è¿›è¡Œæ‰©å±•ä½¿ç”¨ï¼›</li>
<li>javaçš„ååºåˆ—åŒ–è¿‡ç¨‹æ¯æ¬¡éƒ½ä¼š<strong>æ„é€ æ–°çš„å¯¹è±¡ï¼Œä¸èƒ½å¤ç”¨å¯¹è±¡</strong>ã€‚</li>
</ol>
<h3 id="Hadoopçš„åºåˆ—åŒ–ç±»"><a href="#Hadoopçš„åºåˆ—åŒ–ç±»" class="headerlink" title="Hadoopçš„åºåˆ—åŒ–ç±»"></a>Hadoopçš„åºåˆ—åŒ–ç±»</h3><p>Hadoopå®ç°äº†å¤§é‡çš„åºåˆ—åŒ–ç±»ï¼Œå¦‚ä¸‹å¦‚æ‰€ç¤ºï¼š<br><img src="/2017/08/11/0811HadoopIO/Writable-class-hierarchy.png" alt=""><br>é‡ç‚¹å…³æ³¨å³ä¸Šæ–¹çš„éƒ¨åˆ†ï¼ŒåŸºæœ¬ä¸Šæ˜¯å¯¹JavaåŸºæœ¬ç±»å‹çš„å°è£…ã€‚<br><img src="/2017/08/11/0811HadoopIO/writable1.tiff" alt=""></p>
<h3 id="Hadoopçš„åºåˆ—åŒ–æ¥å£"><a href="#Hadoopçš„åºåˆ—åŒ–æ¥å£" class="headerlink" title="Hadoopçš„åºåˆ—åŒ–æ¥å£"></a>Hadoopçš„åºåˆ—åŒ–æ¥å£</h3><h4 id="Writable"><a href="#Writable" class="headerlink" title="Writable"></a>Writable</h4><p>â€‹    Hadoopçš„åºåˆ—åŒ–ç±»æ˜¯é€šè¿‡å®ç°åºåˆ—åŒ–æ¥å£<code>Writable</code>å®ç°çš„ï¼Œ<code>Writable</code>æ¥å£æ˜¯åŸºäºDataInputä¸DatOutputçš„ç®€å•é«˜æ•ˆå¯åºåˆ—åŒ–æ¥å£ã€‚ç»§æ‰¿è¯¥æ¥å£å¿…é¡»å®ç°çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯<code>readField()</code>å’Œ<code>write()</code></p>
<h4 id="WritableComparable"><a href="#WritableComparable" class="headerlink" title="WritableComparable"></a>WritableComparable</h4><p>â€‹    åŒæ—¶å®ç°åºåˆ—åŒ–å’Œæ¯”è¾ƒã€‚ç±»ä¼¼javaçš„Comparableæ¥å£ï¼Œç”¨äºç±»å‹çš„æ¯”è¾ƒã€‚MRå…¶ä¸­ä¸€ä¸ªé˜¶æ®µå«æ’åºï¼Œ é»˜è®¤ä½¿ç”¨Keyæ¥æ’åºã€‚<br>éœ€è¦åŒæ—¶å®ç°ä¸‰ä¸ªæ–¹æ³•<code>readField()</code>ï¼Œ<code>write()</code>å’Œ<code>compareTo()</code>ã€‚</p>
<p>WritableComparableçš„ç®€å•å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> entity;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.DataInput;</div><div class="line"><span class="keyword">import</span> java.io.DataOutput;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Writable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.WritableComparable;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * æœ¬ç±»æ˜¯ä¸€ä¸ªTextçš„äºŒå…ƒç»„&lt;/br&gt;</span></div><div class="line"><span class="comment"> * å®ç°äº†WritableComparableæ¥å£&lt;/br&gt;</span></div><div class="line"><span class="comment"> * æ¯”è¾ƒçš„æ–¹å¼æ˜¯ï¼Œé¦–å…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥ç›¸åŒï¼Œåˆ™æ¯”è¾ƒç¬¬äºŒä¸ªå…ƒç´ ã€‚&lt;/br&gt;</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> hw</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextPair</span> <span class="keyword">implements</span> <span class="title">WritableComparable</span>&lt;<span class="title">TextPair</span>&gt; </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Text firstText;</div><div class="line">	<span class="keyword">private</span> Text secondText;</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		<span class="comment">//å› ä¸ºTextæœ¬èº«ä¹Ÿå°±å®ç°äº†Writableç»“æ„ï¼Œæ­¤æ—¶å°±ç›´æ¥è°ƒç”¨äºŒå…ƒç»„å†…çš„ä¸¤ä¸ªTextçš„writeæ–¹æ³•å³å¯ã€‚</span></div><div class="line">		<span class="keyword">this</span>.firstText.write(out);</div><div class="line">		<span class="keyword">this</span>.secondText.write(out);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		<span class="keyword">this</span>.firstText.readFields(in);</div><div class="line">		<span class="keyword">this</span>.secondText.readFields(in);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(TextPair o)</span> </span>&#123;</div><div class="line">		<span class="comment">//é¦–å…ˆæ¯”è¾ƒfirstTextï¼Œä¸åŒåˆ™æ¯”è¾ƒsecondText</span></div><div class="line">		<span class="keyword">int</span> result = firstText.compareTo(o.getSecondText());</div><div class="line">		<span class="keyword">return</span> result!=<span class="number">0</span>? result: <span class="keyword">this</span>.secondText.compareTo(o.getSecondText());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Text <span class="title">getFirstText</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> firstText;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstText</span><span class="params">(Text firstText)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.firstText = firstText;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Text <span class="title">getSecondText</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> secondText;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecondText</span><span class="params">(Text secondText)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.secondText = secondText;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å®ç°è‡ªå®šä¹‰çš„åºåˆ—åŒ–å¯¹è±¡"><a href="#å®ç°è‡ªå®šä¹‰çš„åºåˆ—åŒ–å¯¹è±¡" class="headerlink" title="å®ç°è‡ªå®šä¹‰çš„åºåˆ—åŒ–å¯¹è±¡"></a>å®ç°è‡ªå®šä¹‰çš„åºåˆ—åŒ–å¯¹è±¡</h3><p>â€‹    å®ç°è‡ªå®šä¹‰çš„Hadoopåºåˆ—åŒ–å¯¹è±¡ï¼Œä¹Ÿéœ€è¦å’Œå†…ç½®çš„åºåˆ—åŒ–å¯¹è±¡ä¸€æ ·ï¼Œå®ç°<code>Writable</code>æ¥å£ï¼Œå…¶ä¸­å¿…é¡»å®ç°çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯<code>readField()</code>å’Œ<code>write()</code>ã€‚</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/11/0811HadoopIO/" data-id="cj6xjfey80004tsjoffbi37pq" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HDFS/">HDFS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-0810HDFSreadwrite" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/10/0810HDFSreadwrite/">HDFSçš„è¯»å†™ç­–ç•¥</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/10/0810HDFSreadwrite/" class="article-date"><time datetime="2017-08-10T13:29:25.000Z" itemprop="datePublished">2017-08-10</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>â€‹    å‘HDFSè¯»å†™æ•°æ®çš„è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯èŠ‚ç‚¹</li>
<li>å®¢æˆ·ç«¯èŠ‚ç‚¹ä¸Šçš„JVM</li>
<li>æ•°æ®èŠ‚ç‚¹</li>
<li>åç§°èŠ‚ç‚¹</li>
</ol>
<h2 id="ä»HDFSè¯»å–æ•°æ®"><a href="#ä»HDFSè¯»å–æ•°æ®" class="headerlink" title="ä»HDFSè¯»å–æ•°æ®"></a>ä»HDFSè¯»å–æ•°æ®</h2><p><img src="/2017/08/10/0810HDFSreadwrite/a_client_reading_data_from_HDFS.png" alt=""><br>â€‹<br>æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å›è°ƒç”¨FileSystemçš„å®ä¾‹<code>DistributedFileSystem</code>çš„openæ–¹æ³•ï¼Œè·å¾—è¿™ä¸ªæ–‡ä»¶çš„<strong>è¾“å…¥æµ</strong>ï¼›</li>
<li>ä»¥RPCçš„æ–¹å¼è°ƒç”¨åç§°èŠ‚ç‚¹ï¼Œä»¥ç¡®å®šæ–‡ä»¶å¼€å¤´éƒ¨åˆ†å—çš„ä½ç½®ï¼ˆåŒ…æ‹¬å‰¯æœ¬çš„ä½ç½®ï¼ŒæŒ‰ç…§ä¸å®¢æˆ·ç«¯çš„è·ç¦»æ¥æ’åºï¼‰ï¼Œ</li>
<li>å®¢æˆ·ç«¯æŒ‰ç…§å°±è¿‘åŸåˆ™ï¼Œè°ƒç”¨è¾“å…¥æµçš„readæ–¹æ³•ä»æœ€è¿‘çš„DataNodeè¯»å–æ•°æ®ï¼Œ è‹¥å®¢æˆ·ç«¯æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥ä»èŠ‚ç‚¹ä¸Šè¯»å–ï¼ˆæœŸé—´å°†æ“ä½œæ—¥å¿—å‘é€ç»™NameNodeï¼‰ï¼›</li>
<li>å®¢æˆ·ç«¯è¯»å–åˆ°æ•°æ®å—æœ«ç«¯ï¼Œå°†å…³é—­ä¸è¿™ä¸ªDataNode çš„è¿æ¥ï¼Œç„¶å<strong>é‡æ–°æŸ¥æ‰¾</strong>ä¸‹ä¸€ä¸ªæ•°æ®å—ã€‚</li>
<li>é‡å¤2-4ç›´åˆ°å½“å®¢æˆ·ç«¯è¯»å–å®Œæˆï¼Œ<code>DFSInputStream</code>å°†è¢«å…³é—­ï¼›</li>
</ol>
<h2 id="å‘HDFSå†™æ•°æ®"><a href="#å‘HDFSå†™æ•°æ®" class="headerlink" title="å‘HDFSå†™æ•°æ®"></a>å‘HDFSå†™æ•°æ®</h2><p><img src="/2017/08/10/0810HDFSreadwrite/a_client_writing_data_to_HDFS.png" alt=""></p>
<ol>
<li>å®¢æˆ·ç«¯é€šè¿‡åœ¨<code>DistributedFileSystem</code>è°ƒç”¨<code>create</code>æ–¹æ³•æ¥åˆ›å»ºæ–‡ä»¶ï¼›</li>
<li><code>DistributedFileSystem</code>çš„ä¸€ä¸ªRPCè°ƒç”¨NameNodeï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿçš„å¯†ç <strong>å‘½åç©ºé—´</strong>ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼›NameNode å°†é€šè¿‡ä¸€äº›æ£€æŸ¥ï¼Œæ¯”å¦‚ ~æ–‡ä»¶æ˜¯å¦å­˜åœ¨~ï¼Œå®¢æˆ·ç«¯ ~æ˜¯å¦æ‹¥æœ‰åˆ›å»ºæƒé™~ ç­‰;é€šè¿‡æ£€æŸ¥ä¹‹åï¼Œåœ¨NameNode æ·»åŠ æ–‡ä»¶ä¿¡æ¯ã€‚æ³¨æ„ï¼Œå› ä¸ºæ­¤æ—¶æ–‡ä»¶æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥<strong>NameNode ä¸Šä¹Ÿæ²¡æœ‰æ–‡ä»¶æ•°æ®å—çš„ä¿¡æ¯</strong>ã€‚</li>
<li>åˆ›å»ºç»“æŸä¹‹åï¼ŒHDFSä¼šè¿”å›ä¸€ä¸ªè¾“å‡ºæµ DFSDataOutputStream ç»™å®¢æˆ·ç«¯ï¼›</li>
<li>å®¢æˆ·ç«¯è°ƒç”¨è¾“å‡ºæµDFSDataOutputStreamçš„writeæ–¹æ³•å‘HDFS ä¸­å¯¹åº”çš„æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</li>
<li>æ•°æ®é¦–å…ˆä¼šè¢«<strong>åˆ†åŒ…</strong>ï¼Œè¿™äº›åˆ†åŒ…ä¼šå†™äººä¸€ä¸ª<strong>è¾“å‡ºæµçš„å†…éƒ¨é˜Ÿåˆ—</strong> Data é˜Ÿåˆ—ä¸­ï¼Œ ~æ¥æ”¶å®Œæ•°æ®åˆ†åŒ…ï¼Œè¾“å‡ºæµDFSDataOutputStreamä¼šå‘NameNodeç”³è¯·ä¿å­˜æ–‡ä»¶å’Œå‰¯æœ¬æ•°æ®å—çš„è‹¥å¹²ä¸ªDataNode ï¼Œ è¿™è‹¥å¹²ä¸ªDataNode ä¼šå½¢æˆä¸€ä¸ªæ•°æ®ä¼ è¾“ç®¡é“ã€‚~ DFSDataOutputStream å°†æ•°æ®ä¼ è¾“ç»™è·ç¦»ä¸Šæœ€çŸ­çš„DataNode ï¼Œè¿™ä¸ªDataNode æ¥æ”¶åˆ°æ•°æ®åŒ…ä¹‹åä¼šä¼ ç»™ä¸‹ä¸€ä¸ªDataNode ã€‚ ~æ•°æ®åœ¨å„DataNodeä¹‹é—´é€šè¿‡ç®¡é“æµåŠ¨ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ç”±è¾“å‡ºæµåˆ†å‘~ï¼Œ ä»¥å‡å°‘ä¼ è¾“å¼€é”€ã€‚</li>
<li>å› ä¸ºå„DataNodeä½äºä¸åŒæœºå™¨ä¸Šï¼Œæ•°æ®éœ€è¦é€šè¿‡ç½‘ç»œå‘é€ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰DataNode çš„æ•°æ®éƒ½æ˜¯å‡†ç¡®çš„ï¼Œ ~æ¥æ”¶åˆ°æ•°æ®çš„ DataNode è¦å‘<strong>å‘é€è€…</strong>å‘é€ç¡®è®¤åŒ…(ACK Packet )~ ã€‚å¯¹äºæŸä¸ªæ•°æ®å—ï¼Œåªæœ‰å½“DFSDataOutputStream æ”¶åˆ°äº†æ‰€æœ‰DataNode çš„æ­£ç¡®ACKï¼Œæ‰èƒ½ç¡®è®¤ä¼ è¾“ç»“æŸã€‚DFSDataOutputStream å†…éƒ¨ä¸“ é—¨ç»´æŠ¤äº†ä¸€ä¸ª<strong>ç­‰å¾…ACK é˜Ÿåˆ—</strong>ï¼Œè¿™ä¸€é˜Ÿåˆ—ä¿å­˜å·²ç»è¿›å…¥ç®¡é“ä¼ è¾“æ•°æ®ã€ä½†æ˜¯å¹¶æœªè¢«å®Œå…¨ç¡®è®¤çš„æ•°æ®åŒ…ã€‚</li>
<li>é‡å¤4-6ï¼ŒDFSDataInputStream ç»§ç»­ç­‰å¾…ç›´åˆ°æ‰€æœ‰æ•°æ®å†™å…¥å®Œæ¯•å¹¶<strong>è¢«ç¡®è®¤</strong>åï¼Œè°ƒç”¨<code>close</code>å…³é—­æµï¼Œè°ƒç”¨<code>complete</code>æ–¹æ³•é€šçŸ¥NameNode æ–‡ä»¶å†™å…¥å®Œæˆã€‚NameNode æ¥æ”¶åˆ°completeæ¶ˆæ¯ä¹‹åï¼Œ ~ç­‰å¾…ç›¸åº”æ•°é‡çš„å‰¯æœ¬å†™å…¥å®Œæ¯•å~ï¼Œ å‘ŠçŸ¥å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p><em>æ•°æ®æµåˆ—è¡¨å½¢æˆä¸€ä¸ªç®¡çº¿ã€‚</em><br><em>ä¸€ä¸ªåŒ…åªæœ‰åœ¨è¢«ç®¡çº¿ä¸­çš„<strong>æ‰€æœ‰èŠ‚ç‚¹</strong>ç¡®è®¤åæ‰ä¼šè¢«ç§»å‡ºç¡®è®¤é˜Ÿåˆ—</em></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/10/0810HDFSreadwrite/" data-id="cj6xjfexr0000tsjoahuucx9a" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HDFS/">HDFS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li></ul>


    </footer>
  </div>
  
</article>



  


  <div id="page-nav">
    <nav><ul class="pagination"><li class="disabled"><span class="page-prev"><i class="fa fa-chevron-left"></i> Prev</a></li><li class="active"><span class="page-number">1</span></li><li><a class="page-number" href="/page/2/">2</a></li><li><a class="page-next" rel="next" href="/page/2/">Next <i class="fa fa-chevron-right"></i></a></li></ul></nav>
  </div>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p></p>

</div>


  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a><span class="sidebar-module-list-count">8</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/HBase/">HBase</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/HDFS/">HDFS</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/MapReduce/">MapReduce</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/NoSQL/">NoSQL</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ä»£ç /">ä»£ç </a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/æ•°æ®å­˜å‚¨/">æ•°æ®å­˜å‚¨</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/HBase/" style="font-size: 10px;">HBase</a> <a href="/tags/HDFS/" style="font-size: 16.67px;">HDFS</a> <a href="/tags/MapReduce/" style="font-size: 13.33px;">MapReduce</a> <a href="/tags/NoSQL/" style="font-size: 10px;">NoSQL</a> <a href="/tags/ä»£ç /" style="font-size: 10px;">ä»£ç </a> <a href="/tags/åˆ†å¸ƒå¼ç³»ç»Ÿ/" style="font-size: 20px;">åˆ†å¸ƒå¼ç³»ç»Ÿ</a> <a href="/tags/æ•°æ®å­˜å‚¨/" style="font-size: 10px;">æ•°æ®å­˜å‚¨</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/08/">August 2017</a><span class="sidebar-module-list-count">12</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2017/08/29/test-1/">test</a>
        </li>
      
        <li>
          <a href="/2017/08/29/hbase/">HBase ç®€ä»‹</a>
        </li>
      
        <li>
          <a href="/2017/08/18/hiveIntro/">hiveç®€ä»‹</a>
        </li>
      
        <li>
          <a href="/2017/08/16/MyTopKClass/">MyTopKClass</a>
        </li>
      
        <li>
          <a href="/2017/08/15/hadoopMRAdv/">hadoopé«˜çº§</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2017 H.W.Huang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
